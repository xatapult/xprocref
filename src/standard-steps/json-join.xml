<?xml version="1.0" encoding="UTF-8"?>
<step name="json-join"
      version-idref="v30"
      category-idrefs="standard-steps"
      short-description="[EDIT] json-join short description"
      required="true"
      publish="false"
      href-specification="{$BASELINK-STANDARD-STEPS}#c.json-join"
      xsi:schemaLocation="http://www.xtpxlib.nl/ns/xprocref ../../xsd/xprocref.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns="http://www.xtpxlib.nl/ns/xprocref">
   <signature>
      <input port="source"
             sequence="true"
             content-types="any"
             primary="true">
         <description>
            <para>[EDIT] input source</para>
         </description>
      </input>
      <output port="result"
              content-types="application/json"
              primary="true"
              sequence="true">
         <description>
            <para>[EDIT] output result</para>
         </description>
      </output>
      <option name="flatten-to-depth"
              as="xs:string?"
              select="'0'"
              required="false">
         <description>
            <para>[EDIT] option flatten-to-depth</para>
         </description>
      </option>
   </signature>
   <summary>
      <para>[EDIT]</para>
      <para>The <code>p:json-join</code> step joins the sequence of documents on port <port>source</port> into a single JSON document (an array) appearing on port <port>result</port>. If the sequence on port <code>source</code> is empty, the empty sequence is returned on port <code>result</code>.</para>
   </summary>
   <description>
      <para>[EDIT]</para>
      <para>The step inspects the documents on port <port>source</port> in turn to create the resulting array:</para>
      <itemizedlist>
         <listitem>
            <para>If the document under inspection is a JSON document representing an array, the array is copied to the resulting array according to the setting of option <option>flatten-to-depth</option>.</para>
         </listitem>
         <listitem>
            <para>For every other type of JSON document, for XML documents, HTML documents, or text documents, their XDM representation is appended to the resulting array.</para>
         </listitem>
         <listitem>
            <para>It is implementation defined if <code>p:json-join</code> is able to process document types not mentioned yet, i.e. types of binary documents. If a processor supports a given type of documents, an entry is created as described above. <emphasis role="bold">[ERROR <step-error-ref code="XC0111"/>]</emphasis>
            </para>
         </listitem>
      </itemizedlist>
      <para>The option <option>flatten-to-depth</option> controls whether and to which depth members of an array appearing on port <port>source</port> are flattened. <emphasis role="bold">[ERROR <step-error-ref code="XC0119"/>]</emphasis> An integer value of <literal>0</literal>, which is the default, means that no flattening takes place, so the array appearing on port <port>source</port> will be contained as an array in the resulting array. An integer value of <literal>1</literal> means that an array on port <port>source</port> is flattened, i.e. the members of that array will appear as individual members in the resulting array. Any value greater than <literal>1</literal> means that the flattening is applied recursively to arrays in arrays up to the given depth. A value of “<literal>unbounded</literal>” means that all arrays in arrays will be flattened. As a consequence, the resulting array appearing on port <port>result</port> will not have any arrays as members. </para>
      <bridgehead>Document properties</bridgehead>
      <para feature="json-join-preserves-none">No document properties are preserved. The joined document has no <property>base-uri</property>. </para>
   </description>
   <step-errors>
      <step-error code="XC0111">
         <description>
            <para> It is a dynamic error if a document of an unsupported document type appears on port <port>source</port> of <code>p:json-join</code>.</para>
         </description>
      </step-error>
      <step-error code="XC0119">
         <description>
            <para>It is a dynamic error if <option>flatten</option> is neither “<literal>unbounded</literal>”, nor a string that may be cast to a non-negative integer.</para>
         </description>
      </step-error>
   </step-errors>
</step>