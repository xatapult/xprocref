<?xml version="1.0" encoding="UTF-8"?>
<step name="compress"
      version-idref="v30"
      category-idrefs="standard-steps"
      short-description="[EDIT] compress short description"
      required="true"
      publish="false"
      href-specification="{$BASELINK-STANDARD-STEPS}#c.compress"
      xsi:schemaLocation="http://www.xtpxlib.nl/ns/xprocref ../../xsd/xprocref.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns="http://www.xtpxlib.nl/ns/xprocref">
   <signature>
      <input port="source"
             primary="true"
             content-types="any"
             sequence="false">
         <description>
            <para>[EDIT] input source</para>
         </description>
      </input>
      <output port="result"
              primary="true"
              content-types="any"
              sequence="false">
         <description>
            <para>[EDIT] output result</para>
         </description>
      </output>
      <option name="format"
              as="xs:QName"
              select="'gzip'"
              required="false">
         <description>
            <para>[EDIT] option format</para>
         </description>
      </option>
      <option name="serialization"
              as="map(xs:QName,item()*)?"
              required="false">
         <description>
            <para>[EDIT] option serialization</para>
         </description>
      </option>
      <option name="parameters"
              as="map(xs:QName, item()*)?"
              required="false">
         <description>
            <para>[EDIT] option parameters</para>
         </description>
      </option>
   </signature>
   <summary>
      <para>[EDIT]</para>
      <para>The <tag>p:compress</tag> step serializes the document appearing on its <port>source</port> port and outputs a compressed version of this on its <port>result</port> port.</para>
   </summary>
   <description>
      <para>[EDIT]</para>
      <para>The <tag>p:compress</tag> step first serializes the document appearing on its <port>source</port>. It then compresses the outcome of this serialization and outputs the result on its <port>result</port> port.</para>
      <para>The <tag>p:compress</tag> step has the following options:</para>
      <variablelist>
         <varlistentry>
            <term>
               <option>format</option>
            </term>
            <listitem>
               <para>The format of the compression can be specified using the <option>format</option> option. Implementations must support the <link xlink:href="https://datatracker.ietf.org/doc/html/rfc1952"
                        role="newpage"
                        xmlns:xlink="http://www.w3.org/1999/xlink">GZIP</link> format, specified with the value <code>gzip</code>. It is implementation-defined what other formats are supported. <emphasis role="bold">[ERROR <step-error-ref code="XC0202"/>]</emphasis>
               </para>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>
               <option>parameters</option>
            </term>
            <listitem>
               <para>The <option>parameters</option> option can be used to supply parameters to control the compression. The semantics of the keys and the allowed values for these keys are implementation-defined. <emphasis role="bold">[ERROR <step-error-ref code="XC0079"/>]</emphasis>
               </para>
            </listitem>
         </varlistentry>
         <varlistentry>
            <term>
               <option>serialization</option>
            </term>
            <listitem>
               <para>The <option>serialization</option> option is provided to control the serialization of content before compression takes place. If the document to be stored has a <code>serialization</code> property, the serialization is controlled by the merger of the two maps where the entries in the <code>serialization</code> property take precedence. Serialization is described in <link xlink:href="https://xproc.org/"
                        role="newpage"
                        xmlns:xlink="http://www.w3.org/1999/xlink">XProcÂ 3.0</link> .</para>
            </listitem>
         </varlistentry>
      </variablelist>
      <bridgehead>Document properties</bridgehead>
      <para feature="compress-preserves-some">All document properties are preserved, except for the <code>content-type</code> property which is updated accordingly and the <code>serialization</code> property which is removed.</para>
   </description>
   <step-errors>
      <step-error code="XC0202">
         <description>
            <para>It is a dynamic error if the compression format cannot be understood, determined and/or processed.</para>
         </description>
      </step-error>
      <step-error code="XC0079">
         <description>
            <para>It is a dynamic error if the map <option>parameters</option> contains an entry whose key is defined by the implementation and whose value is not valid for that key.</para>
         </description>
      </step-error>
   </step-errors>
</step>