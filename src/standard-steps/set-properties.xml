<?xml version="1.0" encoding="UTF-8"?>
<step name="set-properties"
      version-idref="v30"
      category-idrefs="standard-steps"
      short-description="[EDIT] set-properties short description"
      required="true"
      publish="false"
      href-specification="{$BASELINK-STANDARD-STEPS}#c.set-properties"
      xsi:schemaLocation="http://www.xtpxlib.nl/ns/xprocref ../../xsd/xprocref.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns="http://www.xtpxlib.nl/ns/xprocref">
   <signature>
      <input port="source"
             content-types="any"
             primary="true"
             sequence="true">
         <description>
            <para>[EDIT] input source</para>
         </description>
      </input>
      <output port="result"
              content-types="any"
              primary="true"
              sequence="true">
         <description>
            <para>[EDIT] output result</para>
         </description>
      </output>
      <option name="properties"
              required="true"
              as="map(xs:QName,item()*)">
         <description>
            <para>[EDIT] option properties</para>
         </description>
      </option>
      <option name="merge"
              select="true()"
              as="xs:boolean"
              required="false">
         <description>
            <para>[EDIT] option merge</para>
         </description>
      </option>
   </signature>
   <summary>
      <para>[EDIT]</para>
      <para>The <tag>p:set-properties</tag> step sets document properties on the source document.</para>
   </summary>
   <description>
      <para>[EDIT]</para>
      <para>The document properties of the document on the <port>source</port> port are augmented with the values specified in the <option>properties</option> option. The document produced on the <port>result</port> port has the same representation but the adjusted property values.</para>
      <para feature="p-set-properties-merge">If the <option>merge</option> option is true, then the supplied properties are added to the existing properties, overwriting already existing values for a given key. If it is false, the document’s properties are replaced by the new set.</para>
      <para>
         <emphasis role="bold">[ERROR <step-error-ref code="XD0070"/>]</emphasis>
      </para>
      <para>
         <emphasis role="bold">[ERROR <step-error-ref code="XC0069"/>]</emphasis>
      </para>
      <para>If the <option>properties</option> map contains a key equal to the string “<literal>base-uri</literal>” the associated value is taken as the new base URI of the resulting document. <emphasis role="bold">[ERROR <step-error-ref code="XD0064"/>]</emphasis>
      </para>
      <bridgehead>Document properties</bridgehead>
      <para feature="set-properties-preserves-some">If <option>merge</option> is true, document properties not overridden by settings in the <option>properties</option> map are preserved, otherwise the resulting document has only the <literal>content-type</literal> property and the properties specified in the <option>properties</option> map. In particular, if <option>merge</option> is false, the <literal>base-uri</literal> property will not be preserved. This means that the resulting document will not have a base URI if the <option>properties</option> map does not contain a <literal>base-uri</literal> entry. </para>
   </description>
   <step-errors>
      <step-error code="XD0070">
         <description>
            <para>It is a dynamic error if a value is assigned to the <code>serialization</code> document property that cannot be converted into <code>map(xs:QName, item()*)</code> according to the rules in section “QName handling” of <link xlink:href="https://xproc.org/"
                     role="newpage"
                     xmlns:xlink="http://www.w3.org/1999/xlink">XProc 3.0</link> .</para>
         </description>
      </step-error>
      <step-error code="XC0069">
         <description>
            <para>It is a dynamic error if the <option>properties</option> map contains a key equal to the string “<literal>content-type</literal>”.</para>
         </description>
      </step-error>
      <step-error code="XD0064">
         <description>
            <para>It is a dynamic error if the base URI is not both absolute and valid according to <link xlink:href="https://www.rfc-editor.org/info/rfc3986"
                     role="newpage"
                     xmlns:xlink="http://www.w3.org/1999/xlink">RFC 3986</link> .</para>
         </description>
      </step-error>
   </step-errors>
</step>