<?xml version="1.0" encoding="UTF-8"?>
<step name="add-xml-base"
      version-idref="v30"
      category-idrefs="standard-steps"
      short-description="[EDIT] add-xml-base short description"
      required="true"
      publish="false"
      xsi:schemaLocation="http://www.xtpxlib.nl/ns/xprocref ../../../xsd/xprocref.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns="http://www.xtpxlib.nl/ns/xprocref">
   <specification-link href="{$BASELINK-STANDARD-STEPS}#c.add-xml-base"/>
   <signature>
      <input port="source"
             content-types="xml html"
             primary="true"
             sequence="true">
         <description>
            <para>[EDIT] input source</para>
         </description>
      </input>
      <output port="result"
              content-types="xml html"
              primary="true"
              sequence="true">
         <description>
            <para>[EDIT] output result</para>
         </description>
      </output>
      <option name="all"
              as="xs:boolean"
              select="false()"
              required="false">
         <description>
            <para>[EDIT] option all</para>
         </description>
      </option>
      <option name="relative"
              as="xs:boolean"
              select="true()"
              required="false">
         <description>
            <para>[EDIT] option relative</para>
         </description>
      </option>
   </signature>
   <summary>
      <para>[EDIT]</para>
      <para>The <code>p:add-xml-base</code> step exposes the base URI via explicit <code>xml:base</code> attributes. The input document from the <port>source</port> port is replicated to the <port>result</port> port with <code>xml:base</code> attributes added to or corrected on each element as specified by the options on this step.</para>
   </summary>
   <description>
      <para>[EDIT]</para>
      <para>The value of the <option>all</option> option must be a boolean.</para>
      <para>The value of the <option>relative</option> option must be a boolean.</para>
      <para>
         <emphasis role="bold">[ERROR <step-error-ref code="C0058"/>]</emphasis>
      </para>
      <para>The <tag>p:add-xml-base</tag> step modifies its input as follows:</para>
      <itemizedlist>
         <listitem>
            <para>For every element that is a child of the document node: force the element to have an <tag class="attribute">xml:base</tag> attribute with the document's [base URI] property's value as its value.</para>
         </listitem>
         <listitem>
            <para>For other elements:</para>
            <itemizedlist>
               <listitem>
                  <para>If the <option>all</option> option has the value <literal>true</literal>, force the element to have an <tag class="attribute">xml:base</tag> attribute with the element's [base URI] value as its value.</para>
               </listitem>
               <listitem>
                  <para>If the element's [base URI] is different from the its parent's [base URI], force the element to have an <tag class="attribute">xml:base</tag> attribute with the following value: if the value of the <option>relative</option> option is <literal>true</literal>, a string which, when resolved against the parent's [base URI], will give the element's [base URI], otherwise the element's [base URI].</para>
               </listitem>
               <listitem>
                  <para>Otherwise, if there is an <tag class="attribute">xml:base</tag> attribute present, remove it. </para>
               </listitem>
            </itemizedlist>
         </listitem>
      </itemizedlist>
      <bridgehead>Document properties</bridgehead>
      <para feature="add-xml-base-preserves-all">All document properties are preserved.</para>
   </description>
   <step-errors>
      <step-error code="C0058">
         <description>
            <para>It is a dynamic error if the <option>all</option> and <option>relative</option> options are <emphasis>both</emphasis>
               <literal>true</literal>.</para>
         </description>
      </step-error>
   </step-errors>
</step>