<?xml version="1.0" encoding="UTF-8"?>
<step name="unarchive" version-idref="v30" category-idrefs="standard-steps archive compress"
  short-description="Extracts documents from an archive file" required="true" publish="false"
  href-specification="{$BASELINK-STANDARD-STEPS}#c.unarchive" xsi:schemaLocation="http://www.xtpxlib.nl/ns/xprocref ../../xsd/xprocref.xsd"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xdoc="http://www.xtpxlib.nl/ns/xdoc" xmlns:xlink="http://www.w3.org/1999/xlink"
  xmlns:xi="http://www.w3.org/2001/XInclude" xmlns="http://www.xtpxlib.nl/ns/xprocref">

  <!-- ======================================================================= -->

  <signature>

    <input port="source" primary="true" content-types="any" sequence="false">
      <description>
        <para>The archive to extract the documents from.</para>
      </description>
    </input>

    <output port="result" primary="true" content-types="any" sequence="true">
      <description>
        <para>The extracted documents.</para>
      </description>
    </output>

    <option name="include-filter" as="xs:string*" subtype="RegularExpression" required="false">
      <description>
        <para>A sequence of XPath regular expressions (as strings) that determine which files in the archive are extracted. See <xref
            linkend="determining-extracted-files"/>.</para>
      </description>
    </option>

    <option name="exclude-filter" as="xs:string*" subtype="RegularExpression" required="false">
      <description>
        <para>A sequence of XPath regular expressions (as strings) that determine which files in the archive are <emphasis>not</emphasis> extracted.
          See <xref linkend="determining-extracted-files"/>.</para>
      </description>
    </option>

    <option name="format" as="xs:QName?" required="false" select="()">
      <description>
        <xi:include href="text-fragments/archive-format-option.xml"/>
      </description>
    </option>

    <option name="parameters" as="map(xs:QName, item()*)?" required="false" select="()">
      <description>
        <para>Parameters used to control the document extraction. The XProc specification does not define any parameters for this option. A specific
          XProc processor might define its own.</para>
      </description>
    </option>

    <option name="relative-to" as="xs:anyURI?" required="false">
      <description>
        <para>This option can be used to explicitly set the <property>base-uri</property> document-property of the extracted documents. See <xref
            linkend="determining-base-uri"/></para>
      </description>
    </option>

    <option name="override-content-types" as="array(array(xs:string))?" required="false">
      <description>
        <para>Use this to override the content-type determination for the extracted files (the value of their <property>content-type</property>
          document-property). This mechanism works the same as for the <step-ref name="p:archive-manifest"/> step.</para>
      </description>
    </option>

  </signature>

  <!-- ======================================================================= -->

  <summary>
    <para>The <step/> extracts document from an archive file (for instance a ZIP file) and returns these on its <port>result</port> port.</para>
  </summary>

  <!-- ======================================================================= -->

  <description>
    <para>The <step/> step allows you to extract one or more documents from an archive (for instance a ZIP file). The result will be a sequence of the
      extracted documents on its <port>result</port> port.</para>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

    <section xml:id="determining-extracted-files">
      <title>Determining which files to extract</title>

      <para>The <option>include-filter</option> and <option>exclude-filter</option> options determine which files to extract. Both option must be a
        sequence of zero or more XPath regular expressions, as strings.</para>

      <para>TBD</para>
    </section>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

    <section xml:id="determining-base-uri">
      <title>The base URI of the extracted files</title>
      <para>TBD</para>
    </section>

  </description>

  <!-- ======================================================================= -->

  <detail>
    <para>No document-properties from the document on the <port>source</port> port survive.</para>
  </detail>
  
  <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
  
  <detail>
    <xi:include href="text-fragments/zip-detail.xml"/>
  </detail>
  
  <!-- ======================================================================= -->

  <step-errors>
    <step-error code="XC0085"/>
    <step-error code="XC0079"/>
    <step-error code="XC0147"/>
    <step-error code="XC0120"/>
  </step-errors>
  
</step>
