<?xml version="1.0" encoding="UTF-8"?>
<step name="file-delete" version-idref="v30" category-idrefs="file-steps env" short-description="Deletes a file or directory" required="false"
  publish="true" href-specification="{$BASELINK-FILE-STEPS-V30}#c.file-delete"
  xsi:schemaLocation="http://www.xtpxlib.nl/ns/xprocref ../../../xsd/xprocref.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns="http://www.xtpxlib.nl/ns/xprocref">

  <!-- ======================================================================= -->

  <signature>

    <output port="result" primary="true" content-types="application/xml" sequence="false">
      <description>
        <para>A <tag>c:result</tag> element containing the absolute URI of the deleted file or directory (the <code>c</code> prefix here is bound to
          the <code>http://www.w3.org/ns/xproc-step</code> namespace).</para>
      </description>
    </output>

    <option name="href" required="true" as="xs:anyURI">
      <description>
        <para>The URI of the file or directory to delete.</para>
      </description>
    </option>

    <option name="recursive" as="xs:boolean" select="false()" required="false">
      <description>
        <para>When deleting a directory, setting this option to <code>true</code> means that the contents of the directory (any contained files and/or
          sub-directories) will also be deleted.</para>
        <para>When this option is set to <code>false</code> (default), deleting a directory is possible only when the directory is empty.</para>
      </description>
    </option>

    <option name="fail-on-error" as="xs:boolean" select="true()" required="false">
      <description>
        <para>Determines what happens if an error occurs during the delete operation:</para>
        <itemizedlist>
          <listitem>
            <para>If this option is <code>true</code> (default), an appropriate XProc error is raised.</para>
          </listitem>
          <listitem>
            <para>If this option is <code>false</code>, the step returns a <tag>c:error</tag> document (see <link
                xlink:href="https://spec.xproc.org/master/head/xproc/#err-vocab" role="newpage">here</link> for more information) on its
                <port>result</port> port.</para>
          </listitem>
        </itemizedlist>
        <para>If you&#x2019;re deleting a directory with the <option>recursive</option> option set to <code>true</code>, please note that an error may
          mean that a partial delete has already been made.</para>
      </description>
    </option>

  </signature>

  <!-- ======================================================================= -->

  <summary>
    <para>The <step/> step deletes a file or directory.</para>
  </summary>

  <!-- ======================================================================= -->

  <description>

    <para>The <step/> step deletes a file or directory specified in the <option>href</option> option. The <port>result</port> port emits a small XML
      document with only a <tag>c:result</tag> element containing the absolute URI of the deleted file or directory (the <code>c</code> prefix here is
      bound to the <code>http://www.w3.org/ns/xproc-step</code> namespace).</para>

    <para>If you're deleting a directory, you&#x2019;ll probably want the <option>recursive</option> option set to <code>true</code>. This ensures
      that all containing files an/or subdirectories will also be deleted (recursively). Deleting a directory with <option>recursive</option> set to
        <code>false</code> (default) will succeed only when the directory is empty.</para>

  </description>

  <!-- ======================================================================= -->

  <detail>
    <xi:include href="../../text-fragments/no-document-properties-except-content-type.xml"/>
  </detail>

  <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

  <detail>
    <para>Relative values for the <option>href</option> option are resolved against the base URI of the element on which this option is specified. In
      most cases this will be the static base URI of your pipeline (the path where the XProc source containing the <step/> is stored).</para>
  </detail>

  <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

  <detail>
    <xi:include href="../../text-fragments/file-scheme-uris.xml"/>
  </detail>

  <!-- ======================================================================= -->

  <example title="Basic usage">

    <para>The following example deletes an (existing) file <code>data/x.xml</code>:</para>

    <xproc-example href="../../examples/file-delete/file-delete-01.xpl" show-source="false" keep-from="data"/>

  </example>

  <!-- ======================================================================= -->

  <step-errors>
    <step-error code="XC0142"/>
    <step-error code="XD0064"/>
    <step-error code="XC0143"/>
    <step-error code="XD0011"/>
    <step-error code="XC0113"/>
  </step-errors>

</step>
