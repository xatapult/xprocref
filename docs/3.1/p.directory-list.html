<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xtlcon="http://www.xtpxlib.nl/ns/container"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link href="../css/bootstrap.min.css" rel="stylesheet"><link href="../css/xprocref.css" rel="stylesheet"><script defer src="../js/bootstrap.bundle.min.js"></script><title>&nbsp;p:directory-list (3.1)&nbsp;</title><link rel="shortcut icon" href="../images/favicon.ico"></head><body><nav class="navbar navbar-expand-sm bg-secondary navbar-dark "><div class="container-fluid"><a class="navbar-brand" href="../index.html"><img src="../images/logo.png" class="img-fluid" width="18%"></a></div><div class="container-fluid"><ul class="nav justify-content-end nav-pills text-light"><li class="nav-item lead"><a class="nav-link text-light" href="../index.html">home</a></li><li class="nav-item lead"><a class="nav-link text-light" href="../3.0/categories.html">categories</a></li><li class="nav-item dropdown lead"><a class="nav-link dropdown-toggle text-light" data-bs-toggle="dropdown" href="#">info</a><ul class="dropdown-menu"><li class="lead"><a class="dropdown-item" href="../versions.html">versions</a></li><li class="lead"><a class="dropdown-item" href="../error-codes.html">error codes</a></li><li class="lead"><a class="dropdown-item" href="../namespaces.html">namespaces</a></li><li class="lead"><a class="dropdown-item" href="https://xproc.org">XProc</a></li></ul></li><li class="nav-item lead"><a class="nav-link text-light" href="../about.html">about</a></li></ul></div></nav><div class="container pt-5"><div class="sect1" id="sect1-d517e40231"><a name="sect1-d517e40231"><!----></a><h1 class="sect1"><a href="p.delete.html"><span class="link"><img src="../images/previous.png" class="inlinemediaobject next-prev-marker" width="1.5%"></span></a>&nbsp;p:directory-list (3.1)&nbsp;<a href="p.error.html"><span class="link"><img src="../images/next.png" class="inlinemediaobject next-prev-marker" width="1.5%"></span></a></h1><p class="para">List the contents of a directory.</p><ul class="itemizedlist toc toc-2"><li><p class="para tocentry tocentry-2"><a href="#sect2-d517e40244"><span class="link">Summary</span></a></p></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d517e40522"><span class="link">Description</span></a></p><ul class="itemizedlist toc toc-3"><li><p class="para tocentry tocentry-3"><a href="#include-exclude"><span class="link">Including and excluding files and directories</span></a></p></li><li><p class="para tocentry tocentry-3"><a href="#result-doc"><span class="link">The result document</span></a></p></li></ul></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d517e40948"><span class="link">Examples</span></a></p><ul class="itemizedlist toc toc-3"><li><p class="para tocentry tocentry-3"><a href="#p_directory-list-v31-example-basic"><span class="link">Basic usage</span></a></p></li><li><p class="para tocentry tocentry-3"><a href="#p_directory-list-v31-example-depth"><span class="link">Changing the depth of the directory lisiting</span></a></p></li><li><p class="para tocentry tocentry-3"><a href="#p_directory-list-v31-example-inex"><span class="link">Including and excluding files</span></a></p></li><li><p class="para tocentry tocentry-3"><a href="#p_directory-list-v31-handling-all"><span class="link">Handling all files in a directory</span></a></p></li></ul></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d517e41074"><span class="link">Additional details</span></a></p></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d517e41115"><span class="link">Errors raised</span></a></p></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d517e41178"><span class="link">Reference information</span></a></p></li></ul><div class="sect2" id="sect2-d517e40244"><a name="sect2-d517e40244"><!----></a><h2 class="sect2">Summary</h2><div class="programlisting step-signature"><pre class="programlisting step-signature">&lt;p:declare-step type="p:directory-list"&gt;
  &lt;output port="result" primary="true" content-types="application/xml" sequence="false"/&gt;
  &lt;option name="path" as="xs:anyURI" required="true"/&gt;
  &lt;option name="detailed" as="xs:boolean" required="false" select="false()"/&gt;
  &lt;option name="exclude-filter" as="xs:string*" required="false" select="()"/&gt;
  &lt;option name="include-filter" as="xs:string*" required="false" select="()"/&gt;
  &lt;option name="max-depth" as="xs:string?" required="false" select="'1'"/&gt;
  &lt;option name="override-content-types" as="array(array(xs:string))?" required="false" select="()"/&gt;
&lt;/p:declare-step&gt;</pre></div><p class="para">The <code class="code step">p:directory-list</code> step produces an XML document that contains an overview of the contents of a specified directory.</p><p class="para table-header">Ports:</p><div class="table nonumber ports-table"><table class="table nonumber ports-table"><thead><tr><th><p class="para">Port</p></th><th><p class="para">Type</p></th><th><p class="para">Primary?</p></th><th><p class="para">Content types</p></th><th><p class="para">Seq?</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code">result</code></p></td><td><p class="para"><code class="code">output</code></p></td><td><p class="para"><code class="code">true</code></p></td><td><p class="para"><code class="code">application/xml</code></p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para">The resulting XML document that describes the contents of the directory. See <a href="#result-doc" class="xref">The result document</a>.</p></td></tr></tbody></table></div><p class="para table-header">Options:</p><div class="table nonumber options-table"><table class="table nonumber options-table"><thead><tr><th><p class="para">Name</p></th><th><p class="para">Type</p></th><th><p class="para">Req?</p></th><th><p class="para">Default</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code">path</code></p></td><td><p class="para"><code class="code">xs:anyURI</code></p></td><td><p class="para"><code class="code">true</code></p></td><td><p class="para"><code class="code">&nbsp;</code></p></td><td><p class="para">The path of the directory to describe the contents of.</p></td></tr><tr><td><p class="para"><code class="code">detailed</code></p></td><td><p class="para"><code class="code">xs:boolean</code></p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para">Whether detailed information about the directory and its contents is returned. See TBD</p></td></tr><tr><td><p class="para"><code class="code">exclude-filter</code></p></td><td><p class="para"><code class="code">xs:string*</code></p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para"><code class="code">()</code></p></td><td><p class="para">A sequence of XPath regular expression that specifies which directories/files are excluded. See <a href="#include-exclude" class="xref">Including and excluding files and directories</a>. See
          also the <a href="#p_directory-list-v31-example-inex"><span class="link">Including and excluding files</span></a> example.</p></td></tr><tr><td><p class="para"><code class="code">include-filter</code></p></td><td><p class="para"><code class="code">xs:string*</code></p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para"><code class="code">()</code></p></td><td><p class="para">A sequence of XPath regular expression that specifies which directories/files are included. See <a href="#include-exclude" class="xref">Including and excluding files and directories</a>. See
          also the <a href="#p_directory-list-v31-example-inex"><span class="link">Including and excluding files</span></a> example.</p></td></tr><tr><td><p class="para"><code class="code">max-depth</code></p></td><td><p class="para"><code class="code">xs:string?</code></p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para"><code class="code">1</code></p></td><td><p class="para">How deep (how many levels of subdirectories) the directory is described. Its value must be a string that can be cast to either a
          (non-negative) integer or the word <code class="code">unbounded</code>:</p><ul class="itemizedlist"><li><p class="para">A value of <code class="code">0</code> means that only information about the given directory is returned.</p></li><li><p class="para">A value of <code class="code">1</code> (default) returns information about the direct contents of the given directory.</p></li><li><p class="para">A numerical value greater than <code class="code">1</code> returns information up to that level of subdirectories.</p></li><li><p class="para">A value <code class="code">unbounded</code> returns information about all subdirectories.</p></li></ul><p class="para">See also the <a href="#p_directory-list-v31-example-depth"><span class="link">Changing the depth of the directory lisiting</span></a> example.</p></td></tr><tr><td><p class="para"><code class="code">override-content-types</code></p></td><td><p class="para"><code class="code">array(array(xs:string))?</code></p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para"><code class="code">()</code></p></td><td><p class="para">Use this to override the content-type determination of files. Determining the content-type of a file happens when you ask for
          detailed information (the <code class="code option">detailed</code> option is set to <code class="code">true</code>).</p><p class="para">This works just like the mechanism for the <code class="code option">override-content-types</code> option of <code class="code step"><a href="p.archive-manifest.html"><span class="link">p:archive-manifest</span></a></code>,
          except that the regular expression matching is done against the paths as used for the matching of the <code class="code option">include-filter</code> and
            <code class="code option">exclude-filter</code> options. For more information see <a href="#include-exclude" class="xref">Including and excluding files and directories</a>.</p></td></tr></tbody></table></div></div><div class="sect2" id="sect2-d517e40522"><a name="sect2-d517e40522"><!----></a><h2 class="sect2">Description</h2><p class="para">The <code class="code step">p:directory-list</code> step provides you with an overview of the contents of a directory, similar to a Windows <code class="code">dir</code> or a Unix/Linux/macOS
        <code class="code">ls</code> command. This often comes in handy, for instance when you need to perform some operation on <span class="emphasis italic">all</span> files in
      a directory (or a directory tree). The <a href="#p_directory-list-v31-handling-all"><span class="link">Handling all files in a directory</span></a> example gives an example of how to do this.</p><p class="para">The <code class="code step">p:directory-list</code> step takes a directory path as its main input in the <code class="code option">path</code> option. The <code class="code port">result</code> port emits a document
      (see <a href="#result-doc" class="xref">The result document</a>) that describes this directory by listing its contents (files and subdirectories). What happens exactly
      depends on the settings of the other options. The step has no input port(s).</p><p class="para">The directory to describe, as specified in the <code class="code option">path</code> option, <span class="emphasis italic">must</span> exist. Otherwise, error
        <code class="code"><a href="#error-XC0017"><span class="link">XC0017</span></a></code> is raised.</p><div class="sect3" id="include-exclude"><a name="include-exclude"><!----></a><h3 class="sect3">Including and excluding files and directories</h3><p class="para">The <code class="code option">include-filter</code> and <code class="code option">exclude-filter</code> determine which files and directories are included/excluded in the
        result. Both options are a sequence of (zero or more) XPath regular expression strings.</p><ul class="itemizedlist"><li><p class="para">If the <code class="code option">include-filter</code> is not specified (or the empty sequence), <span class="emphasis italic">all</span> files/directories are
            included.</p><p class="para">Otherwise, every regular expression string in the option value is matched against the <span class="emphasis italic">relative</span> file/directory
            paths (relative to the path that was given in the <code class="code option">path</code> option). A match means the file/directory is included.</p></li><li><p class="para">If the <code class="code option">exclude-filter</code> is not specified (or the empty sequence), <span class="emphasis italic">no</span> files/directories are
            excluded.</p><p class="para">Otherwise, every regular expression string in the option value is matched against the <span class="emphasis italic">relative</span> file/directory
            paths (relative to the path that was given in the <code class="code option">path</code> option). A match means the file/directory is excluded.</p></li><li><p class="para">A file/directory is part of the result if it is included and not excluded.</p></li></ul><p class="para">Matching the regular expressions behaves like applying the XPath <code class="code"><a href="https://www.w3.org/TR/xpath-functions-31/#func-matches" target="_blank"><span class="link newpage">matches()</span></a></code> function (like in
          <code class="code">matches($relative-path, $regular-expression)</code>).</p></div><div class="sect3" id="result-doc"><a name="result-doc"><!----></a><h3 class="sect3">The result document</h3><p class="para">The root element of the resulting XML document is <code class="tag">&lt;c:directory&gt;</code> (the <code class="code">c</code> prefix here is bound to the
          <code class="code">http://www.w3.org/ns/xproc-step</code> namespace):</p><div class="programlisting" id="c_directory-xlisting"><a name="c_directory-xlisting"><!----></a><pre class="programlisting">&lt;c:directory name = xs:string
             xml:base = xs:anyURI
             hidden? = xs:boolean
             last-modified? = xs:dateTime
             readable? = xs:boolean
             size? = xs:integer
             writable? = xs:boolean &gt;
  ( &lt;c:file&gt; |
    &lt;c:directory&gt; |
    &lt;c:other&gt;  )*
&lt;/c:directory&gt;</pre></div><p style="font-size: 50%;" class="para halfbreak">&nbsp;</p><div class="table nonumber" id="c_directory-attributes"><a name="c_directory-attributes"><!----></a><table class="table nonumber"><thead><tr><th><p class="para">Attribute</p></th><th><p class="para">#</p></th><th><p class="para">Type</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code code-width-limited">name</code></p></td><td><p class="para">1</p></td><td><p class="para"><code class="code code-width-limited">xs:string</code></p></td><td><p class="para">The name of the directory (without a path in front).</p></td></tr><tr><td><p class="para"><code class="code code-width-limited">xml:base</code></p></td><td><p class="para">1</p></td><td><p class="para"><code class="code code-width-limited">xs:anyURI</code></p></td><td><p class="para">The URI of the directory, always ending with a slash.</p><ul class="itemizedlist"><li><p class="para">For the root <code class="tag">&lt;c:directory&gt;</code> element this will be the absolute path of the directory described.</p></li><li><p class="para">For any nested <code class="tag">&lt;c:directory&gt;</code> elements, this will be the name of the directory.</p></li></ul></td></tr><tr><td><p class="para"><code class="code code-width-limited">hidden</code></p></td><td><p class="para">?</p></td><td><p class="para"><code class="code code-width-limited">xs:boolean</code></p></td><td><p class="para">Whether this directory is hidden for the current user. See below.</p></td></tr><tr><td><p class="para"><code class="code code-width-limited">last-modified</code></p></td><td><p class="para">?</p></td><td><p class="para"><code class="code code-width-limited">xs:dateTime</code></p></td><td><p class="para">The date and time this directory was last modified. See below.</p></td></tr><tr><td><p class="para"><code class="code code-width-limited">readable</code></p></td><td><p class="para">?</p></td><td><p class="para"><code class="code code-width-limited">xs:boolean</code></p></td><td><p class="para">Whether this directory is readable for the current user. See below.</p></td></tr><tr><td><p class="para"><code class="code code-width-limited">size</code></p></td><td><p class="para">?</p></td><td><p class="para"><code class="code code-width-limited">xs:integer</code></p></td><td><p class="para">The size of the directory entry (in bytes). See below.</p></td></tr><tr><td><p class="para"><code class="code code-width-limited">writable</code></p></td><td><p class="para">?</p></td><td><p class="para"><code class="code code-width-limited">xs:boolean</code></p></td><td><p class="para">Whether this directory is readable for the current user. See below.</p></td></tr></tbody></table></div><p style="font-size: 50%;" class="para halfbreak">&nbsp;</p><div class="table nonumber" id="c_directory-child-elements"><a name="c_directory-child-elements"><!----></a><table class="table nonumber"><thead><tr><th><p class="para">Child element</p></th><th><p class="para">#</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code code-width-limited">c:file</code></p></td><td><p class="para">*</p></td><td><p class="para">An file in the given directory</p></td></tr><tr><td><p class="para"><code class="code code-width-limited">c:directory</code></p></td><td><p class="para">*</p></td><td><p class="para">A subdirectory in the given directory</p></td></tr><tr><td><p class="para"><code class="code code-width-limited">c:other</code></p></td><td><p class="para">*</p></td><td><p class="para">Anything in the given directory that is “special”. What is considered special is implementation defined and therefore
          depends on the XProc processor used.</p></td></tr></tbody></table></div><p class="para">Every file in a directory is described using a <code class="tag">&lt;c:file&gt;</code> element:</p><div class="programlisting" id="c_file-xlisting"><a name="c_file-xlisting"><!----></a><pre class="programlisting">&lt;c:file name = xs:string
        xml:base = xs:anyURI
        content-type? = xs:string
        hidden? = xs:boolean
        last-modified? = xs:dateTime
        readable? = xs:boolean
        size? = xs:integer
        writable? = xs:boolean /&gt;</pre></div><p style="font-size: 50%;" class="para halfbreak">&nbsp;</p><div class="table nonumber" id="c_file-attributes"><a name="c_file-attributes"><!----></a><table class="table nonumber"><thead><tr><th><p class="para">Attribute</p></th><th><p class="para">#</p></th><th><p class="para">Type</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code code-width-limited">name</code></p></td><td><p class="para">1</p></td><td><p class="para"><code class="code code-width-limited">xs:string</code></p></td><td><p class="para">The name of the file (without a path in front).</p></td></tr><tr><td><p class="para"><code class="code code-width-limited">xml:base</code></p></td><td><p class="para">1</p></td><td><p class="para"><code class="code code-width-limited">xs:anyURI</code></p></td><td><p class="para">The name of the file (identical to the <code class="code">name</code> attribute).</p></td></tr><tr><td><p class="para"><code class="code code-width-limited">content-type</code></p></td><td><p class="para">?</p></td><td><p class="para"><code class="code code-width-limited">xs:string</code></p></td><td><p class="para">The content-type (MIME type) of this file. If this cannot be determined, its value is <code class="code">application/octet-stream</code>. See
        below.</p></td></tr><tr><td><p class="para"><code class="code code-width-limited">hidden</code></p></td><td><p class="para">?</p></td><td><p class="para"><code class="code code-width-limited">xs:boolean</code></p></td><td><p class="para">Whether this file is hidden for the current user. See below.</p></td></tr><tr><td><p class="para"><code class="code code-width-limited">last-modified</code></p></td><td><p class="para">?</p></td><td><p class="para"><code class="code code-width-limited">xs:dateTime</code></p></td><td><p class="para">The date and time this file was last modified. See below.</p></td></tr><tr><td><p class="para"><code class="code code-width-limited">readable</code></p></td><td><p class="para">?</p></td><td><p class="para"><code class="code code-width-limited">xs:boolean</code></p></td><td><p class="para">Whether this file is readable for the current user. See below.</p></td></tr><tr><td><p class="para"><code class="code code-width-limited">size</code></p></td><td><p class="para">?</p></td><td><p class="para"><code class="code code-width-limited">xs:integer</code></p></td><td><p class="para">The size of the file entry (in bytes). See below.</p></td></tr><tr><td><p class="para"><code class="code code-width-limited">writable</code></p></td><td><p class="para">?</p></td><td><p class="para"><code class="code code-width-limited">xs:boolean</code></p></td><td><p class="para">Whether this file is readable for the current user. See below.</p></td></tr></tbody></table></div><p class="para">Anything else in a directory is described using the <code class="tag">&lt;c:other&gt;</code> element. This looks just like the <code class="tag">&lt;c:file&gt;</code> element, but
        without a <code class="code">content-type</code> attribute.</p><p class="break">&nbsp;</p><p class="para break-before">About the optional attributes on the result elements:</p><ul class="itemizedlist"><li><p class="para">If the <code class="code option">detailed</code> option is <code class="code">false</code> (default), only the <code class="code">name</code> and <code class="code">xml:base</code>
            attributes will be there.</p></li><li><p class="para">If the <code class="code option">detailed</code> option is <code class="code">true</code>, the other, optional, attributes will be present also.</p></li></ul><p class="para">What the values of the various attributes actually mean is implementation defined and therefore depends on the XProc processor used. For
        most attributes there will be no surprises, but what, for instance, is the size of a directory? It may take some experiments to get things
        right.</p></div></div><div class="sect2" id="sect2-d517e40948"><a name="sect2-d517e40948"><!----></a><h2 class="sect2">Examples</h2><div class="sect3" id="p_directory-list-v31-example-basic"><a name="p_directory-list-v31-example-basic"><!----></a><h3 class="sect3">Basic usage</h3><p class="para">Assume we have a disk layout that looks like this:</p><div class="programlisting"><pre class="programlisting">-- data -- + -- x1.txt
           | 
           + -- x1.xml
           |
           + -- sub1/ -- + -- sub1-x1.xml
                        |
                        + -- sub2/ -- + -- sub2.tmp 
                                      |
                                      + -- sub2-x1.txt</pre></div><p class="para">For the examples to come we assume this <code class="code">data</code> directory is in the same location as our pipeline. Simply asking for the directory
      listing, using the default values for the options of <code class="code step">p:directory-list</code>, is as follows:</p><p class="para keep-with-next">Pipeline document:</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:output port="result"/&gt;

  &lt;p:directory-list path="data"/&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para keep-with-next">Result document:</p><div class="programlisting"><pre class="programlisting">&lt;c:directory xmlns:c="http://www.w3.org/ns/xproc-step"
             xml:base="file:/…/…/data/"
             name="data"&gt;
   &lt;c:directory xml:base="sub1/" name="sub1"/&gt;
   &lt;c:file xml:base="x1.txt" name="x1.txt"/&gt;
   &lt;c:file xml:base="x1.xml" name="x1.xml"/&gt;
&lt;/c:directory&gt;</pre></div><p class="para">When we ask for details, the following happens:</p><p class="para keep-with-next">Pipeline document:</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:output port="result"/&gt;

  &lt;p:directory-list path="data" detailed="true"/&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para keep-with-next">Result document:</p><div class="programlisting"><pre class="programlisting">&lt;c:directory xmlns:c="http://www.w3.org/ns/xproc-step"
             xmlns:mox="http://www.xml-project.com/morganaxproc"
             xml:base="file:/…/…/data/"
             name="data"
             readable="true"
             writable="true"
             mox:executable="true"
             hidden="false"
             last-modified="2024-12-27T11:30:00.96Z"
             size="0"&gt;
   &lt;c:directory xml:base="sub1/"
                name="sub1"
                readable="true"
                writable="true"
                mox:executable="true"
                hidden="false"
                last-modified="2024-12-27T11:30:00.95Z"
                size="0"/&gt;
   &lt;c:file xml:base="x1.txt"
           name="x1.txt"
           content-type="text/plain"
           readable="true"
           writable="true"
           mox:executable="true"
           hidden="false"
           last-modified="2024-12-27T11:30:00.96Z"
           size="0"/&gt;
   &lt;c:file xml:base="x1.xml"
           name="x1.xml"
           content-type="application/xml"
           readable="true"
           writable="true"
           mox:executable="true"
           hidden="false"
           last-modified="2024-12-27T11:30:00.96Z"
           size="81"/&gt;
&lt;/c:directory&gt;</pre></div></div><div class="sect3" id="p_directory-list-v31-example-depth"><a name="p_directory-list-v31-example-depth"><!----></a><h3 class="sect3">Changing the depth of the directory lisiting</h3><p class="para">The following examples work on the same directory structure as described in <a href="#p_directory-list-v31-example-basic"><span class="link">Basic usage</span></a>. Asking for a directory
      description with <code class="code option">max-depth</code> option set to <code class="code">0</code> just gives us the main directory itself:</p><p class="para keep-with-next">Pipeline document:</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:output port="result"/&gt;

  &lt;p:directory-list path="data" max-depth="0"/&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para keep-with-next">Result document:</p><div class="programlisting"><pre class="programlisting">&lt;c:directory xmlns:c="http://www.w3.org/ns/xproc-step"
             xml:base="file:/…/…/data/"
             name="data"/&gt;</pre></div><p class="para">And getting the full directory structure is as follows:</p><p class="para keep-with-next">Pipeline document:</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:output port="result"/&gt;

  &lt;p:directory-list path="data" max-depth="unbounded"/&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para keep-with-next">Result document:</p><div class="programlisting"><pre class="programlisting">&lt;c:directory xmlns:c="http://www.w3.org/ns/xproc-step"
             xml:base="file:/…/…/data/"
             name="data"&gt;
   &lt;c:directory xml:base="sub1/" name="sub1"&gt;
      &lt;c:file xml:base="sub1-x1.xml" name="sub1-x1.xml"/&gt;
      &lt;c:directory xml:base="sub2/" name="sub2"&gt;
         &lt;c:file xml:base="sub2-x1.txt" name="sub2-x1.txt"/&gt;
         &lt;c:file xml:base="sub2.tmp" name="sub2.tmp"/&gt;
      &lt;/c:directory&gt;
   &lt;/c:directory&gt;
   &lt;c:file xml:base="x1.txt" name="x1.txt"/&gt;
   &lt;c:file xml:base="x1.xml" name="x1.xml"/&gt;
&lt;/c:directory&gt;</pre></div></div><div class="sect3" id="p_directory-list-v31-example-inex"><a name="p_directory-list-v31-example-inex"><!----></a><h3 class="sect3">Including and excluding files</h3><p class="para">The following examples work on the same directory structure as described in <a href="#p_directory-list-v31-example-basic"><span class="link">Basic usage</span></a>. Assume we only need the
      text files in the directory tree: all files ending with <code class="code">.txt</code>. A regular expression that matches this is <code class="code">\.txt$</code>, so we
      have to pass this as the value of the <code class="code option">include-filter</code> option:</p><p class="para keep-with-next">Pipeline document:</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:output port="result"/&gt;

  &lt;p:directory-list path="data" include-filter="\.txt$" max-depth="unbounded"/&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para keep-with-next">Result document:</p><div class="programlisting"><pre class="programlisting">&lt;c:directory xmlns:c="http://www.w3.org/ns/xproc-step"
             xml:base="file:/…/…/data/"
             name="data"&gt;
   &lt;c:directory xml:base="sub1/" name="sub1"&gt;
      &lt;c:directory xml:base="sub2/" name="sub2"&gt;
         &lt;c:file xml:base="sub2-x1.txt" name="sub2-x1.txt"/&gt;
      &lt;/c:directory&gt;
   &lt;/c:directory&gt;
   &lt;c:file xml:base="x1.txt" name="x1.txt"/&gt;
&lt;/c:directory&gt;</pre></div><p class="para">Assume that we know that all files that start with an <code class="code">x</code> are not interesting. We can exclude these by passing the regular
      expression <code class="code">^x</code> as the value of the <code class="code option">exclude-filter</code> option:</p><p class="para keep-with-next">Pipeline document:</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:output port="result"/&gt;

  &lt;p:directory-list path="data" include-filter="\.txt$" exclude-filter="^x" max-depth="unbounded"/&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para keep-with-next">Result document:</p><div class="programlisting"><pre class="programlisting">&lt;c:directory xmlns:c="http://www.w3.org/ns/xproc-step"
             xml:base="file:/…/…/data/"
             name="data"&gt;
   &lt;c:directory xml:base="sub1/" name="sub1"&gt;
      &lt;c:directory xml:base="sub2/" name="sub2"&gt;
         &lt;c:file xml:base="sub2-x1.txt" name="sub2-x1.txt"/&gt;
      &lt;/c:directory&gt;
   &lt;/c:directory&gt;
&lt;/c:directory&gt;</pre></div><p class="para">Finally, assume we both need the XML and text files in the directory tree, but not anything else. For this we could do two things:</p><ul class="itemizedlist"><li><p class="para">Create a regular expression that incorporates both, and pass it as an <code class="code">include-filter</code> attribute on the
            <code class="tag">&lt;p:directory-list&gt;</code> element, just like we did in the examples above: <code class="tag">&lt;p:directory list path="data"
            include-filter="\.(xml|txt)$" max-depth="unbounded"/&gt;</code></p></li><li><p class="para">Or we could pass a regular expression for each file type. If we do it this way we can no longer pass the <code class="code option">include-filter</code>
          option as an attribute. We have to use a <code class="tag">&lt;p:with-option&gt;</code> child element:</p></li></ul><p class="para keep-with-next">Pipeline document:</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:output port="result"/&gt;

  &lt;p:directory-list path="data" max-depth="unbounded"&gt;
    &lt;p:with-option name="include-filter" select="('\.xml$', '\.txt$')"/&gt;
  &lt;/p:directory-list&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para keep-with-next">Result document:</p><div class="programlisting"><pre class="programlisting">&lt;c:directory xmlns:c="http://www.w3.org/ns/xproc-step"
             xml:base="file:/…/…/data/"
             name="data"&gt;
   &lt;c:directory xml:base="sub1/" name="sub1"&gt;
      &lt;c:file xml:base="sub1-x1.xml" name="sub1-x1.xml"/&gt;
      &lt;c:directory xml:base="sub2/" name="sub2"&gt;
         &lt;c:file xml:base="sub2-x1.txt" name="sub2-x1.txt"/&gt;
      &lt;/c:directory&gt;
   &lt;/c:directory&gt;
   &lt;c:file xml:base="x1.txt" name="x1.txt"/&gt;
   &lt;c:file xml:base="x1.xml" name="x1.xml"/&gt;
&lt;/c:directory&gt;</pre></div></div><div class="sect3" id="p_directory-list-v31-handling-all"><a name="p_directory-list-v31-handling-all"><!----></a><h3 class="sect3">Handling all files in a directory</h3><p class="para">Again, the following examples work on the same directory structure as described in <a href="#p_directory-list-v31-example-basic"><span class="link">Basic usage</span></a>. Assume we need to
      do something with all XML documents in the <code class="code">data</code> directory. Using <code class="code step">p:directory-list</code> we can easily get the names of these files. However, to
      process them we will need to load them, and for that its handy if we have their full absolute URIs. These can be added using the <code class="code step"><a href="p.make-absolute-uris.html"><span class="link">p:make-absolute-uris</span></a></code> step and change the <code class="code">name</code> attributes into full URIs:</p><p class="para keep-with-next">Pipeline document:</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:output port="result"/&gt;

  &lt;p:directory-list path="data" include-filter="\.xml$" max-depth="unbounded"/&gt;
  &lt;p:make-absolute-uris match="@name"/&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para keep-with-next">Result document:</p><div class="programlisting"><pre class="programlisting">&lt;c:directory xmlns:c="http://www.w3.org/ns/xproc-step"
             xml:base="file:/…/…/data/"
             name="file:/…/…/data/data"&gt;
   &lt;c:directory xml:base="sub1/" name="file:/…/…/data/sub1/sub1"&gt;
      &lt;c:file xml:base="sub1-x1.xml" name="file:/…/…/data/sub1/sub1-x1.xml"/&gt;
   &lt;/c:directory&gt;
   &lt;c:file xml:base="x1.xml" name="file:/…/…/data/x1.xml"/&gt;
&lt;/c:directory&gt;</pre></div><p class="para">We can now use this result to process all the XML documents. The following pipeline simply loads them (using <code class="code step"><a href="p.load.html"><span class="link">p:load</span></a></code>), and
      wraps all contents (using <code class="code step"><a href="p.wrap-sequence.html"><span class="link">p:wrap-sequence</span></a></code>) in an <code class="tag">&lt;all-xml-documents&gt;</code> element:</p><p class="para keep-with-next">Pipeline document:</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:output port="result"/&gt;

  &lt;p:directory-list path="data" include-filter="\.xml$" max-depth="unbounded"/&gt;
  &lt;p:make-absolute-uris match="@name"/&gt;

  &lt;p:for-each&gt;
    &lt;p:with-input select="//c:file"/&gt;
    &lt;p:load href="{/*/@name}"/&gt;
  &lt;/p:for-each&gt;
  &lt;p:wrap-sequence wrapper="all-xml-documents"/&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para keep-with-next">Result document:</p><div class="programlisting"><pre class="programlisting">&lt;all-xml-documents&gt;
   &lt;data&gt;This is document sub1/sub1-x1.xml&lt;/data&gt;
   &lt;data&gt;This is document data/x1.xml&lt;/data&gt;
&lt;/all-xml-documents&gt;</pre></div></div></div><div class="sect2" id="sect2-d517e41074"><a name="sect2-d517e41074"><!----></a><h2 class="sect2">Additional details</h2><ul class="itemizedlist"><li><p class="para">Only the <code class="code property">base-uri</code> property will be set. Its value will be the absolute URI of the directory described.</p></li><li><p class="para">A relative value for the <code class="code option">path</code> option is resolved against the base URI of the element on which this option is specified. In
      most cases this will be the static base URI of your pipeline (the path where the XProc source containing the <code class="code step">p:directory-list</code> is stored).</p></li><li><p class="para">If some entry (file or directory) is included in the result, all directories leading up to this entry are always included, even if they're
      excluded because of the <code class="code option">include-filter</code> and <code class="code option">exclude-filter</code> option settings. This assures that the hierarchy of
      the result always matches the hierarchy of the filesystem.</p></li><li><p class="para">Working on “normal” files and/or directories (on disk, URI scheme <code class="code">file://</code>) is always supported. Whether any other
    types are supported is implementation-defined, and therefore depends on the XProc processor used. For this, also the interpretation/definition of
    what is a “directory” and “file” may vary.</p></li><li><p class="para">An XProc processor may add additional, implementation-defined, attributes to the various result elements as described in <a href="#result-doc" class="xref">The result document</a>. These attributes will always be in some, XProc processor dependent, namespace.</p></li></ul></div><div class="sect2" id="sect2-d517e41115"><a name="sect2-d517e41115"><!----></a><h2 class="sect2">Errors raised</h2><div class="table nonumber error-codes-table"><table class="table nonumber error-codes-table"><thead><tr><th><p class="para">Error code</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para" id="error-XC0012"><a name="error-XC0012"><!----></a><a href="../error-codes.html#error-XC0012"><span class="link"><code class="code">XC0012</code></span></a></p></td><td><p class="para">It is a dynamic error if the contents of the directory path are not available to the step due to access restrictions in the environment in
        which the pipeline is run.</p></td></tr><tr><td><p class="para" id="error-XC0017"><a name="error-XC0017"><!----></a><a href="../error-codes.html#error-XC0017"><span class="link"><code class="code">XC0017</code></span></a></p></td><td><p class="para">It is a dynamic error if the absolute path does not identify a directory.</p></td></tr><tr><td><p class="para" id="error-XC0090"><a name="error-XC0090"><!----></a><a href="../error-codes.html#error-XC0090"><span class="link"><code class="code">XC0090</code></span></a></p></td><td><p class="para">It is a dynamic error if an implementation does not support directory listing for a specified scheme.</p></td></tr><tr><td><p class="para" id="error-XC0147"><a name="error-XC0147"><!----></a><a href="../error-codes.html#error-XC0147"><span class="link"><code class="code">XC0147</code></span></a></p></td><td><p class="para">It is a dynamic error if the specified value is not a valid XPath regular expression.</p></td></tr><tr><td><p class="para" id="error-XD0064"><a name="error-XD0064"><!----></a><a href="../error-codes.html#error-XD0064"><span class="link"><code class="code">XD0064</code></span></a></p></td><td><p class="para">It is a dynamic error if the base URI is not both absolute and valid according to <a href="https://www.rfc-editor.org/info/rfc3986" target="_blank"><span class="link newpage">RFC&nbsp;3986</span></a> .</p></td></tr></tbody></table></div></div><div class="sect2" id="sect2-d517e41178"><a name="sect2-d517e41178"><!----></a><h2 class="sect2">Reference information</h2><p class="para">This description of the <code class="code step">p:directory-list</code> step is for XProc version: <a href="index.html"><span class="link">3.1</span></a>. This is a non-required step (an XProc 3.1 processor does not have to support this).</p><p class="para">The formal specification for the <code class="code step">p:directory-list</code> step can be found <a href="https://spec.xproc.org/lastcall-2024-08/head/steps/#c.directory-list" target="_blank"><span class="link newpage">here</span></a>.</p><p class="para">The <code class="code step">p:directory-list</code> step is part of categories:</p><ul class="itemizedlist"><li><p class="para"><a href="XProc_file_and_directory_related_steps.html"><span class="link">XProc file and directory related steps</span></a></p></li><li><p class="para"><a href="Interaction_with_the_environment.html"><span class="link">Interaction with the environment</span></a></p></li></ul><p class="para">The <code class="code step">p:directory-list</code> step is also present in version:
                <a href="../3.0/p.directory-list.html"><span class="link">3.0</span></a>.</p></div></div></div><p>&nbsp;</p></body></html>