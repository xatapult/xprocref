<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xtlcon="http://www.xtpxlib.nl/ns/container"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link href="../css/bootstrap.min.css" rel="stylesheet"><link href="../css/xprocref.css" rel="stylesheet"><script defer src="../js/bootstrap.bundle.min.js"></script><title>&nbsp;p:cast-content-type (3.1)&nbsp;</title><link rel="shortcut icon" href="../images/favicon.ico"></head><body><nav class="navbar navbar-expand-sm bg-secondary navbar-dark "><div class="container-fluid"><a class="navbar-brand" href="../index.html"><img src="../images/logo.png" class="img-fluid" width="18%"></a></div><div class="container-fluid"><ul class="nav justify-content-end nav-pills text-light"><li class="nav-item lead"><a class="nav-link text-light" href="../index.html">home</a></li><li class="nav-item lead"><a class="nav-link text-light" href="../3.0/categories.html">categories</a></li><li class="nav-item dropdown lead"><a class="nav-link dropdown-toggle text-light" data-bs-toggle="dropdown" href="#">info</a><ul class="dropdown-menu"><li class="lead"><a class="dropdown-item" href="../versions.html">versions</a></li><li class="lead"><a class="dropdown-item" href="../error-codes.html">error codes</a></li><li class="lead"><a class="dropdown-item" href="../namespaces.html">namespaces</a></li><li class="lead"><a class="dropdown-item" href="https://xproc.org">XProc</a></li></ul></li><li class="nav-item lead"><a class="nav-link text-light" href="../about.html">about</a></li></ul></div></nav><div class="container pt-5"><p class="para page-banner">This site is work in progress and therefore incomplete yet.</p><div class="sect1" id="sect1-d286e19308"><a name="sect1-d286e19308"><!----></a><h1 class="sect1"><a href="p.archive-manifest.html"><span class="link"><img src="../images/previous.png" class="inlinemediaobject next-prev-marker" width="1.5%"></span></a>&nbsp;p:cast-content-type (3.1)&nbsp;<a href="p.compare.html"><span class="link"><img src="../images/next.png" class="inlinemediaobject next-prev-marker" width="1.5%"></span></a></h1><p class="para">Changes the media type of a document.</p><ul class="itemizedlist toc toc-2"><li><p class="para tocentry tocentry-2"><a href="#sect2-d286e19321"><span class="link">Summary</span></a></p></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d286e19483"><span class="link">Description</span></a></p><ul class="itemizedlist toc toc-3"><li><p class="para tocentry tocentry-3"><a href="#sect3-d286e19524"><span class="link">Converting XML documents</span></a></p></li><li><p class="para tocentry tocentry-3"><a href="#sect3-d286e19706"><span class="link">Converting HTML documents</span></a></p></li><li><p class="para tocentry tocentry-3"><a href="#sect3-d286e19758"><span class="link">Converting JSON documents</span></a></p></li><li><p class="para tocentry tocentry-3"><a href="#sect3-d286e19835"><span class="link">Converting text documents</span></a></p></li><li><p class="para tocentry tocentry-3"><a href="#sect3-d286e19906"><span class="link">Converting other media types</span></a></p></li><li><p class="para tocentry tocentry-3"><a href="#c-data"><span class="link">c:data documents</span></a></p></li><li><p class="para tocentry tocentry-3"><a href="#cct-media-type-summary"><span class="link">XProc media type usage</span></a></p></li></ul></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d286e20244"><span class="link">Examples</span></a></p><ul class="itemizedlist toc toc-3"><li><p class="para tocentry tocentry-3"><a href="#p_cast-content-type-v31-converting-json-xml"><span class="link">Converting the XML representation of JSON</span></a></p></li><li><p class="para tocentry tocentry-3"><a href="#p_cast-content-type-v31-converting-param-sets"><span class="link">Converting param-sets</span></a></p></li><li><p class="para tocentry tocentry-3"><a href="#p_cast-content-type-v31-converting-xml-to-text"><span class="link">Converting XML to text</span></a></p></li><li><p class="para tocentry tocentry-3"><a href="#p_cast-content-type-v31-converting-json-to-xml"><span class="link">Converting JSON into XML</span></a></p></li><li><p class="para tocentry tocentry-3"><a href="#p_cast-content-type-v31-converting-weird-to-xml"><span class="link">Converting a binary media type into XML</span></a></p></li></ul></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d286e20406"><span class="link">Additional details</span></a></p></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d286e20437"><span class="link">Errors raised</span></a></p></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d286e20605"><span class="link">Reference information</span></a></p></li></ul><div class="sect2" id="sect2-d286e19321"><a name="sect2-d286e19321"><!----></a><h2 class="sect2">Summary</h2><div class="programlisting step-signature"><pre class="programlisting step-signature">&lt;p:declare-step type="p:cast-content-type"&gt;
  &lt;input port="source" primary="true" content-types="any" sequence="false"/&gt;
  &lt;output port="result" primary="true" content-types="any" sequence="false"/&gt;
  &lt;option name="content-type" as="xs:string" required="true"/&gt;
  &lt;option name="parameters" as="map(xs:QName,item()*)?" required="false" select="()"/&gt;
&lt;/p:declare-step&gt;</pre></div><p class="para">The <code class="code step">p:cast-content-type</code> step takes the document appearing on its <code class="code port">source</code> port and changes its media type according to the value of the
        <code class="code option">content-type</code> option, transforming the document if necessary.</p><p class="para table-header">Ports:</p><div class="table nonumber ports-table"><table class="table nonumber ports-table"><thead><tr><th><p class="para">Type</p></th><th><p class="para">Port</p></th><th><p class="para">Primary?</p></th><th><p class="para">Content types</p></th><th><p class="para">Seq?</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code">input</code></p></td><td><p class="para"><code class="code">source</code></p></td><td><p class="para"><code class="code">true</code></p></td><td><p class="para"><code class="code">any</code></p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para">The document to change the media type of.</p></td></tr><tr><td><p class="para"><code class="code">output</code></p></td><td><p class="para"><code class="code">result</code></p></td><td><p class="para"><code class="code">true</code></p></td><td><p class="para"><code class="code">any</code></p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para">The resulting document.</p></td></tr></tbody></table></div><p class="para table-header">Options:</p><div class="table nonumber options-table"><table class="table nonumber options-table"><thead><tr><th><p class="para">Name</p></th><th><p class="para">Type</p></th><th><p class="para">Req?</p></th><th><p class="para">Default</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code">content-type</code></p></td><td><p class="para"><code class="code">xs:string</code></p></td><td><p class="para"><code class="code">true</code></p></td><td><p class="para"><code class="code">&nbsp;</code></p></td><td><p class="para">The media type of the resulting document.</p><p class="para">This must be a valid media type (either <code class="code">type/subtype</code> or <code class="code">type/subtype+ext</code>). If not, error <code class="code"><a href="#error-XD0079"><span class="link">XD0079</span></a></code> is raised.</p></td></tr><tr><td><p class="para"><code class="code">parameters</code></p></td><td><p class="para"><code class="code">map(xs:QName,item()*)?</code></p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para"><code class="code">()</code></p></td><td><p class="para">Parameters controlling the casting/transformation of the document. Keys, values and their meaning depend on the XProc processor
          used.</p></td></tr></tbody></table></div></div><div class="sect2" id="sect2-d286e19483"><a name="sect2-d286e19483"><!----></a><h2 class="sect2">Description</h2><p class="para">A document flowing through an XProc pipeline has a <span class="emphasis italic">media type</span>, which tells the XProc processor what kind of document it
      is dealing with. The media type of a document is recorded in its <code class="code property">content-type</code> document-property. Example values are
        <code class="code">text/xml</code> for XML documents, <code class="code">application/json</code> for JSON documents, etc. For more information about media types see for
      example <a href="https://en.wikipedia.org/wiki/Media_type" target="_blank"><span class="link newpage">Wikipedia</span></a>.</p><p class="para">The <code class="code step">p:cast-content-type</code> step has a required <code class="code option">content-type</code> option and tries to cast (change) the media type of the document appearing
      on its <code class="code port">source</code> port according to the value of this option. Sometimes this is a (very) simple operation: for instance, changing one
      XML media type to another just changes the value of the <code class="code property">content-type</code> document-property. However, you can also request more
      complex changes, like converting an XML document into JSON or vice versa.</p><p class="para">Of course, not every media type can be cast into every other media type. The following sections describe what you can (and cannot) do. If
      you request an impossible cast, error <code class="code"><a href="#error-XC0071"><span class="link">XC0071</span></a></code> is raised.</p><p class="para">A brief explanation of media types and how XProc treats them can be found in the <a href="#cct-media-type-summary" class="xref">XProc media type usage</a> section
      below.</p><div class="sect3" id="sect3-d286e19524"><a name="sect3-d286e19524"><!----></a><h3 class="sect3">Converting XML documents</h3><p class="para">When the input document is an XML document (has an XML media type), the following casts are supported:</p><ul class="itemizedlist"><li><p class="para">Casting to another XML media type simply changes the <code class="code property">content-type</code> document-property.</p></li><li><p class="para">Casting to an HTML media type changes the <code class="code property">content-type</code> document-property and removes any
              <code class="code property">serialization</code> document-property. </p></li><li><p class="para">Casting to a JSON media type converts the XML into JSON:</p><ul class="itemizedlist"><li><p class="para">The <a href="https://www.w3.org/TR/xpath-functions-31" target="_blank"><span class="link newpage">XPath and XQuery Functions and Operators 3.1</span></a>
                standard defines an <a href="https://www.w3.org/TR/xpath-functions-31/#json-to-xml-mapping" target="_blank"><span class="link newpage">XML format for the
                  representation of JSON data</span></a>. The XPath function <a href="https://www.w3.org/TR/xpath-functions-31/#func-xml-to-json" target="_blank"><span class="link newpage"><code class="code">fn:xml-to-json()</code></span></a> converts this format into a JSON conformant string (and for further processing,
                  <a href="https://www.w3.org/TR/xpath-functions-31/#func-parse-json"><span class="link"><code class="code">fn:parse-json()</code></span></a> turns this string
                into a map/array).</p><p class="para">If an input document of <code class="code step">p:cast-content-type</code> is conformant to this <a href="https://www.w3.org/TR/xpath-functions-31/#json-to-xml-mapping" target="_blank"><span class="link newpage">XML format for the representation of JSON
                  data</span></a>, it’s converted into its JSON equivalent (like calling <code class="code">fn:parse-json(fn:xml-to-json())</code>). See
                  <a href="#p_cast-content-type-v31-converting-json-xml"><span class="link">Converting the XML representation of JSON</span></a> for an example.</p></li><li><p class="para">If the input document has a <code class="tag">&lt;c:param-set&gt;</code> root element and <code class="tag">&lt;c:param name="…" value="…"/&gt;</code> child elements (the
                  <code class="code">c</code> prefix here is bound to the <code class="code">http://www.w3.org/ns/xproc-step</code> namespace), it will turn this into a JSON
                map with the values of the <code class="code">name</code> attributes as keys. See the <a href="#p_cast-content-type-v31-converting-param-sets"><span class="link">Converting param-sets</span></a> example.</p><p class="para">Param-sets are an XProc&nbsp;1.0 construct, used for passing parameters (there were no maps in those days). Unless you’re
                converting XProc&nbsp;1.0 steps into 3.x, it’s unlikely you’ll need this feature.</p></li><li><p class="para">In all other cases it’s up to the XProc processor what happens. It could turn your XML into some kind of JSON, but it could
                just as well raise an error.</p></li></ul><p class="para">A <code class="code property">serialization</code> document-property is removed when converting to JSON.</p></li><li id="casting-xml-to-text"><a name="casting-xml-to-text"><!----></a><p class="para">Casting to a text media type converts the XML into text. The incoming XML comes out as text, as a string, complete with tags,
            attributes, etc.</p><p class="para">The result of this conversion is the same as calling the XPath <a href="https://www.w3.org/TR/xpath-functions-31/#func-serialize" target="_blank"><span class="link newpage"><code class="code">fn:serialize($doc, $param)</code></span></a>
            function, where <code class="code">$doc</code> is the document to convert and <code class="code">$param</code> is its <code class="code property">serialization</code>
            document-property. See the <a href="#p_cast-content-type-v31-converting-xml-to-text"><span class="link">Converting XML to text</span></a> example.</p><p class="para">A <code class="code property">serialization</code> document-property is removed.</p></li><li><p class="para">Casting to any other media type where the input document is a <code class="tag">&lt;c:data&gt;</code> document (see <a href="#c-data" class="xref">c:data documents</a>) results in a
            document with the specified media type and a representation that is the content of the <code class="tag">&lt;c:data&gt;</code> element after decoding it. The
            value of the <code class="code">c:data/@content-type</code> attribute and the value of the <code class="code option">content-type</code> option of <code class="code step">p:cast-content-type</code> must be the
            same!</p><p class="para">A <code class="code property">serialization</code> document-property is removed.</p></li><li><p class="para">Casting to any other media type where the input is not a valid <code class="tag">&lt;c:data&gt;</code> document is implementation-defined and therefore
            depends on the XProc processor used.</p></li></ul></div><div class="sect3" id="sect3-d286e19706"><a name="sect3-d286e19706"><!----></a><h3 class="sect3">Converting HTML documents</h3><p class="para">When the input document is an HTML document (has an HTML media type), the following casts are supported:</p><ul class="itemizedlist"><li><p class="para">Casting to another HTML media type simply changes the <code class="code property">content-type</code> document-property.</p></li><li><p class="para">Casting to an XML media type changes the <code class="code property">content-type</code> document-property and removes a
              <code class="code property">serialization</code> document-property. </p></li><li><p class="para">Casting to a JSON media type is implementation-defined and therefore depends on the XProc processor used.</p></li><li><p class="para">Casting to a text media type works the same as casting an XML media type to text. See <a href="#casting-xml-to-text" class="xref">casting XML to text</a>
            above.</p></li><li><p class="para">Casting to any other media type is implementation-defined and therefore depends on the XProc processor used.</p></li></ul></div><div class="sect3" id="sect3-d286e19758"><a name="sect3-d286e19758"><!----></a><h3 class="sect3">Converting JSON documents</h3><p class="para">When the input document is a JSON document (has a JSON media type), the following casts are supported:</p><ul class="itemizedlist"><li><p class="para">Casting to another JSON media type simply changes the <code class="code property">content-type</code> document-property.</p></li><li><p class="para">Casting to an HTML media type is implementation-defined and therefore depends on the XProc processor used.</p></li><li><p class="para">Casting to an XML media type converts the JSON into XML according to the rules specified in the XPath <a href="https://www.w3.org/TR/xpath-functions-31/#json-to-xml-mapping" target="_blank"><span class="link newpage">XML format for the representation of JSON
              data</span></a>. See the <a href="#p_cast-content-type-v31-converting-json-to-xml"><span class="link">Converting JSON into XML</span></a> example.</p><p class="para">A <code class="code property">serialization</code> document-property is removed.</p></li><li><p class="para">Casting to a text media type converts the JSON into text. The incoming JSON (which in XProc consists of maps/arrays) comes out as
            text, as a string.</p><p class="para">The result of this conversion is the same as calling the XPath <a href="https://www.w3.org/TR/xpath-functions-31/#func-serialize" target="_blank"><span class="link newpage"><code class="code">fn:serialize($doc, $param)</code></span></a>
            function, where <code class="code">$doc</code> is the document to convert and <code class="code">$param</code> is its <code class="code property">serialization</code>
            document-property.</p><p class="para">A <code class="code property">serialization</code> document-property is removed.</p></li><li><p class="para">Casting to any other media type is implementation-defined and therefore depends on the XProc processor used.</p></li></ul></div><div class="sect3" id="sect3-d286e19835"><a name="sect3-d286e19835"><!----></a><h3 class="sect3">Converting text documents</h3><p class="para">When the input document is an text document (has a text media type), the following casts are supported:</p><ul class="itemizedlist"><li><p class="para">Casting to another text media type simply changes the <code class="code property">content-type</code> document-property.</p></li><li><p class="para">Casting to an XML media type parses the text value of the document by calling the XPath <a href="https://www.w3.org/TR/xpath-functions-31/#func-parse-xml" target="_blank"><span class="link newpage"><code class="code">fn:parse-xml()</code></span></a> function. This
            assumes of course that the text is a well-formed XML document. If not, error <code class="code"><a href="#error-XD0049"><span class="link">XD0049</span></a></code> is raised.</p></li><li><p class="para">Casting to an HTML media type parses the document into an HTML document. How this is done is implementation-defined and therefore
            depends on the XProc processor used. If unsuccessful, error <code class="code"><a href="#error-XD0060"><span class="link">XD0060</span></a></code> is raised.</p></li><li><p class="para">Casting to a JSON media type parses the document by calling the XPath <a href="https://www.w3.org/TR/xpath-functions-31/#func-parse-json" target="_blank"><span class="link newpage"><code class="code">fn:parse-json($doc, $param)</code></span></a>
            function, where <code class="code">$doc</code> is the document to convert and <code class="code">$param</code> is its <code class="code property">serialization</code>
            document-property. </p><p class="para">A <code class="code property">serialization</code> document-property is removed.</p></li><li><p class="para">Casting to any other media type is implementation-defined and therefore depends on the XProc processor used.</p></li></ul></div><div class="sect3" id="sect3-d286e19906"><a name="sect3-d286e19906"><!----></a><h3 class="sect3">Converting other media types</h3><p class="para">When the input document has any other media type (meaning XProc treats it as a binary document), the following casts are supported:</p><ul class="itemizedlist"><li><p class="para">Casting from an unrecognized media type to an XML media type produces a <code class="tag">&lt;c:data&gt;</code> document (see <a href="#c-data" class="xref">c:data documents</a>). The
              <code class="tag">&lt;c:data/@content-type&gt;</code> attribute is the document’s content type. The content of the <code class="code">c:data</code> element is the
            base64 encoded representation of the document. See the <a href="#p_cast-content-type-v31-converting-weird-to-xml"><span class="link">Converting a binary media type into XML</span></a> example.</p><p class="para">A <code class="code property">serialization</code> document-property is removed.</p></li><li><p class="para">Casting from an unrecognized media type to a HTML, JSON, text or other unrecognized media type is implementation-defined and therefore
            depends on the XProc processor used.</p></li></ul></div><div class="sect3" id="c-data"><a name="c-data"><!----></a><h3 class="sect3"><code class="tag">&lt;c:data&gt;</code> documents</h3><p class="para">The <code class="code step">p:cast-content-type</code> step uses <code class="tag">&lt;c:data&gt;</code> documents to convert XML from and into binary media types (the <code class="code">c</code> prefix here is bound
        to the <code class="code">http://www.w3.org/ns/xproc-step</code> namespace):</p><div class="programlisting" id="c_data-xlisting"><a name="c_data-xlisting"><!----></a><pre class="programlisting">&lt;c:data content-type = xs:string
        charset? = xs:string
        encoding? = xs:string /&gt;</pre></div><p class="para halfbreak" style="font-size: 50%;">&nbsp;</p><div class="table nonumber" id="c_data-attributes"><a name="c_data-attributes"><!----></a><table class="table nonumber"><thead><tr><th><p class="para">Attribute</p></th><th><p class="para">#</p></th><th><p class="para">Type</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code code-width-limited">content-type</code></p></td><td><p class="para">1</p></td><td><p class="para"><code class="code code-width-limited">xs:string</code></p></td><td><p class="para">The MIME type of the content.</p></td></tr><tr><td><p class="para"><code class="code code-width-limited">charset</code></p></td><td><p class="para">?</p></td><td><p class="para"><code class="code code-width-limited">xs:string</code></p></td><td><p class="para">The character set of the content, for instance <code class="code">UTF-8</code> or <code class="code">ASCII</code>. For an explanation of character encodings see
          <a href="https://en.wikipedia.org/wiki/Character_encoding" target="_blank"><span class="link newpage">Wikipedia</span></a>.</p></td></tr><tr><td><p class="para"><code class="code code-width-limited">encoding</code></p></td><td><p class="para">?</p></td><td><p class="para"><code class="code code-width-limited">xs:string</code></p></td><td><p class="para">The encoding of the content. The most used encoding is <code class="code">base64</code> (see <a href="https://en.wikipedia.org/wiki/Base64" target="_blank"><span class="link newpage">Wikipedia</span></a>).</p></td></tr></tbody></table></div></div><div class="sect3" id="cct-media-type-summary"><a name="cct-media-type-summary"><!----></a><h3 class="sect3">XProc media type usage</h3><p class="para">A document <span class="emphasis italic">media type</span> (in XProc passed around in the <code class="code property">content-type</code> document-property) tells XProc
        (and your code if it needs to know this) what kind of document we’re dealing with: the <span class="emphasis italic">document type</span>. XProc
        recognizes and handles five document types: XML, HTML, JSON, text and binary. </p><p class="para">The relation between document type and media type is as follows:</p><div class="table nonumber"><table class="table nonumber"><thead><tr><th><p class="para">Document type</p></th><th><p class="para">Media types</p></th><th><p class="para">Examples</p></th></tr></thead><tbody><tr><td><p class="para">XML</p></td><td><p class="para"><code class="code">*/xml</code></p><p class="para"><code class="code">*/*+xml</code> except <code class="code">application/xhtml+xml</code></p></td><td><p class="para"><code class="code">text/xml</code></p><p class="para"><code class="code">application/xml</code></p><p class="para"><code class="code">image/svg+xml</code></p></td></tr><tr><td><p class="para">HTML</p></td><td><p class="para"><code class="code">text/html</code></p><p class="para"><code class="code">application/xhtml+xml</code></p></td><td><p class="para"><code class="code">text/html</code></p><p class="para"><code class="code">application/xhtml+xml</code></p></td></tr><tr><td><p class="para">JSON</p></td><td><p class="para"><code class="code">application/json</code></p></td><td><p class="para"><code class="code">application/json</code></p></td></tr><tr><td><p class="para">Text</p></td><td><p class="para"><code class="code">text/*</code></p><p class="para">(not matching one of the XML or HTML media types)</p></td><td><p class="para"><code class="code">text/plain</code></p><p class="para"><code class="code">text/csv</code></p></td></tr><tr><td><p class="para">Binary</p></td><td><p class="para">Anything else</p></td><td><p class="para"><code class="code">image/jpeg</code></p><p class="para"><code class="code">application/octet-stream</code></p><p class="para"><code class="code">application/zip</code></p></td></tr></tbody></table></div></div></div><div class="sect2" id="sect2-d286e20244"><a name="sect2-d286e20244"><!----></a><h2 class="sect2">Examples</h2><div class="sect3" id="p_cast-content-type-v31-converting-json-xml"><a name="p_cast-content-type-v31-converting-json-xml"><!----></a><h3 class="sect3">Converting the XML representation of JSON</h3><p class="para">If an input document of <code class="code step">p:cast-content-type</code> is conformant to the XPath <a href="https://www.w3.org/TR/xpath-functions-31/#json-to-xml-mapping"><span class="link">XML format for the representation of JSON data</span></a> and the <code class="code option">content-type</code> option is a JSON media type, <code class="code step">p:cast-content-type</code> converts
      this into its JSON equivalent.</p><p class="para">The following source document is a shortened version of the example in the XPath standard: </p><div class="programlisting"><pre class="programlisting">&lt;map xmlns="http://www.w3.org/2005/xpath-functions"&gt;
   &lt;string key="desc"&gt;Distances &lt;/string&gt;
   &lt;boolean key="uptodate"&gt;true&lt;/boolean&gt;
   &lt;null key="author"/&gt;
   &lt;map key="cities"&gt;
      &lt;array key="Brussels"&gt;
         &lt;map&gt;
            &lt;string key="to"&gt;London&lt;/string&gt;
            &lt;number key="distance"&gt;322&lt;/number&gt;
         &lt;/map&gt;
      &lt;/array&gt;
   &lt;/map&gt;
&lt;/map&gt;</pre></div><p class="para keep-with-next">Pipeline document:</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:input port="source"/&gt;
  &lt;p:output port="result"/&gt;

  &lt;p:cast-content-type content-type="application/json"/&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para">The resulting JSON map:</p><div class="programlisting"><pre class="programlisting">{"desc":"Distances ","uptodate":true,"author":null,"cities":{"Brussels":[{"to":"London","distance":322}]}}</pre></div></div><div class="sect3" id="p_cast-content-type-v31-converting-param-sets"><a name="p_cast-content-type-v31-converting-param-sets"><!----></a><h3 class="sect3">Converting param-sets</h3><p class="para">Param-sets are constructs used in the XProc&nbsp;1.0 days for passing sets of parameters, for instance to XSLT stylesheets. The current
      version uses maps for this. To enable converting param-sets into maps, <code class="code step">p:cast-content-type</code> contains support for this. In XProc, a map is JSON data, so the
        <code class="code option">content-type</code> option must be a JSON media type.</p><p class="para">The source param-set document:</p><div class="programlisting"><pre class="programlisting">&lt;c:param-set xmlns:c="http://www.w3.org/ns/xproc-step"&gt;
   &lt;c:param name="param1" value="y"/&gt;
   &lt;c:param name="param2" value="1234"/&gt;
&lt;/c:param-set&gt;</pre></div><p class="para keep-with-next">Pipeline document:</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:input port="source"/&gt;
  &lt;p:output port="result"/&gt;

  &lt;p:cast-content-type content-type="application/json"/&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para">The resulting JSON map:</p><div class="programlisting"><pre class="programlisting">{"param1":"y","param2":"1234"}</pre></div><p class="para">JSON maps are passed around as XPath maps, so it’s easy to store such a map in a variable and use it later. Just add the following
      variable declaration directly after the <code class="code step">p:cast-content-type</code> invocation:</p><div class="programlisting"><pre class="programlisting">&lt;p:variable name="param-set-map" as="map(*)" select="."/&gt;</pre></div><p class="para">Unless you’re converting XProc&nbsp;1.0 code into a newer version, i’s unlikely you’ll need this param-set conversion
      feature.</p></div><div class="sect3" id="p_cast-content-type-v31-converting-xml-to-text"><a name="p_cast-content-type-v31-converting-xml-to-text"><!----></a><h3 class="sect3">Converting XML to text</h3><p class="para">Let’s convert this simple XML document into text:</p><div class="programlisting"><pre class="programlisting">&lt;input-document timestamp="2024-08-23T09:12:45"&gt;
   &lt;text color="red"&gt;Hi there!&lt;/text&gt;
&lt;/input-document&gt;</pre></div><p class="para keep-with-next">Pipeline document:</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:input port="source"/&gt;
  &lt;p:output port="result"/&gt;

  &lt;p:cast-content-type content-type="text/plain"/&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para">The resulting <span class="emphasis italic">text</span> (it looks like it is another XML document, but it is just text):</p><div class="programlisting"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;input-document timestamp="2024-08-23T09:12:45"&gt;
  &lt;text color="red"&gt;Hi there!&lt;/text&gt;
&lt;/input-document&gt;</pre></div><p class="para">Now assume we need this text representation without the XML header (the <code class="code">&lt;?xml … ?&gt;</code> part at the top). The <code class="code step">p:cast-content-type</code> step
      uses the document <code class="code property">serialization</code> document-property to guide the conversions. This document-property is a map containing the
      required <a href="https://www.w3.org/TR/xslt-xquery-serialization-31/" target="_blank"><span class="link newpage">serialization properties</span></a>. For this example:
        <code class="code">map{'omit-xml-declaration': true()}</code>.</p><p class="para">Document-properties can be specified using the <code class="code step"><a href="p.set-properties.html"><span class="link">p:set-properties</span></a></code> step. The value of the <code class="code option">properties</code> option
      of <code class="code step">p:set-properties</code> is itself a map, with the document-property names as keys. Therefore, its value becomes a map within a map:
        <code class="code">map{'serialization': map{'omit-xml-declaration': true()}}</code>.</p><p class="para">The following code (using the same input document as above) does the trick: </p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:input port="source"/&gt;
  &lt;p:output port="result"/&gt;

  &lt;p:set-properties properties="map{'serialization': map{'omit-xml-declaration': true()}}"/&gt;

  &lt;p:cast-content-type content-type="text/plain"/&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para keep-with-next">Result document:</p><div class="programlisting"><pre class="programlisting">&lt;input-document timestamp="2024-08-23T09:12:45"&gt;
  &lt;text color="red"&gt;Hi there!&lt;/text&gt;
&lt;/input-document&gt;</pre></div></div><div class="sect3" id="p_cast-content-type-v31-converting-json-to-xml"><a name="p_cast-content-type-v31-converting-json-to-xml"><!----></a><h3 class="sect3">Converting JSON into XML</h3><p class="para">Converting JSON into XML means <code class="code step">p:cast-content-type</code> produces XML according to the XPath <a href="https://www.w3.org/TR/xpath-functions-31/#json-to-xml-mapping" target="_blank"><span class="link newpage">XML format for the representation of JSON
        data</span></a> specification. Here we do the inverse of what is done in the <a href="#p_cast-content-type-v31-converting-json-xml"><span class="link">Converting the XML representation of JSON</span></a> example.</p><p class="para keep-with-next">Source document:</p><div class="programlisting"><pre class="programlisting">{"desc":"Distances ","uptodate":true,"author":null,"cities":{"Brussels":[{"to":"London","distance":322}]}}</pre></div><p class="para keep-with-next">Pipeline document:</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:input port="source"/&gt;
  &lt;p:output port="result"/&gt;

  &lt;p:cast-content-type content-type="text/xml"/&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para keep-with-next">Result document:</p><div class="programlisting"><pre class="programlisting">&lt;map xmlns="http://www.w3.org/2005/xpath-functions"&gt;
   &lt;string key="desc"&gt;Distances &lt;/string&gt;
   &lt;boolean key="uptodate"&gt;true&lt;/boolean&gt;
   &lt;null key="author"/&gt;
   &lt;map key="cities"&gt;
      &lt;array key="Brussels"&gt;
         &lt;map&gt;
            &lt;string key="to"&gt;London&lt;/string&gt;
            &lt;number key="distance"&gt;322&lt;/number&gt;
         &lt;/map&gt;
      &lt;/array&gt;
   &lt;/map&gt;
&lt;/map&gt;</pre></div></div><div class="sect3" id="p_cast-content-type-v31-converting-weird-to-xml"><a name="p_cast-content-type-v31-converting-weird-to-xml"><!----></a><h3 class="sect3">Converting a binary media type into XML</h3><p class="para">This example transforms a piece of text that has been given the (bogus) media type of <code class="code">x/x</code> into XML. Because XProc does not
          recognize this media type, it treats the document as binary. The result of the <code class="code step">p:cast-content-type</code> step is the document’s <code class="code">base64</code>
          encoded contents, wrapped in a <code class="tag">&lt;c:data&gt;</code> element.</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:input port="source"&gt;
    &lt;p:inline content-type="x/x"&gt;Hi there!&lt;/p:inline&gt;
  &lt;/p:input&gt;
  &lt;p:output port="result"/&gt;

  &lt;p:cast-content-type content-type="text/xml"/&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para keep-with-next">Result document:</p><div class="programlisting"><pre class="programlisting">&lt;c:data xmlns:c="http://www.w3.org/ns/xproc-step"
        content-type="x/x"
        encoding="base64"&gt;SGkgdGhlcmUh&lt;/c:data&gt;</pre></div></div></div><div class="sect2" id="sect2-d286e20406"><a name="sect2-d286e20406"><!----></a><h2 class="sect2">Additional details</h2><ul class="itemizedlist"><li><p class="para">If the value of the <code class="code option">content-type</code> option and the media type of a document are the same, the document will appear unchanged
      on the <code class="code port">result</code> port.</p></li><li><p class="para"><code class="code step">p:cast-content-type</code> preserves all document-properties of the document(s) appearing on its <code class="code port">source</code> port.</p><p class="para">Exceptions are the <code class="code property">content-type</code> document-property which is updated accordingly and the
        <code class="code property">serialization</code> document-property which is sometimes removed.</p></li></ul></div><div class="sect2" id="sect2-d286e20437"><a name="sect2-d286e20437"><!----></a><h2 class="sect2">Errors raised</h2><div class="table nonumber error-codes-table"><table class="table nonumber error-codes-table"><thead><tr><th><p class="para">Error code</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para" id="error-XC0071"><a name="error-XC0071"><!----></a><a href="../error-codes.html#error-XC0071"><span class="link"><code class="code">XC0071</code></span></a></p></td><td><p class="para">It is a dynamic error if the <code class="tag">&lt;p:cast-content-type&gt;</code> step cannot perform the requested cast.</p></td></tr><tr><td><p class="para" id="error-XC0072"><a name="error-XC0072"><!----></a><a href="../error-codes.html#error-XC0072"><span class="link"><code class="code">XC0072</code></span></a></p></td><td><p class="para">It is a dynamic error if the <code class="tag">&lt;c:data&gt;</code> contains content is not a valid base64 string.</p></td></tr><tr><td><p class="para" id="error-XC0073"><a name="error-XC0073"><!----></a><a href="../error-codes.html#error-XC0073"><span class="link"><code class="code">XC0073</code></span></a></p></td><td><p class="para">It is a dynamic error if the <code class="tag">&lt;c:data&gt;</code> element does not have a <code class="tag">@content-type</code> attribute.</p></td></tr><tr><td><p class="para" id="error-XC0074"><a name="error-XC0074"><!----></a><a href="../error-codes.html#error-XC0074"><span class="link"><code class="code">XC0074</code></span></a></p></td><td><p class="para">It is a dynamic error if the <code class="code option">content-type</code> is supplied and is not the same as the <code class="tag">@content-type</code> specified on the <code class="tag">&lt;c:data&gt;</code> element.</p></td></tr><tr><td><p class="para" id="error-XC0079"><a name="error-XC0079"><!----></a><a href="../error-codes.html#error-XC0079"><span class="link"><code class="code">XC0079</code></span></a></p></td><td><p class="para">It is a dynamic error if the map <code class="code option">parameters</code> contains an entry whose key is defined by the implementation and whose value
        is not valid for that key.</p></td></tr><tr><td><p class="para" id="error-XD0049"><a name="error-XD0049"><!----></a><a href="../error-codes.html#error-XD0049"><span class="link"><code class="code">XD0049</code></span></a></p></td><td><p class="para">It is a dynamic error if the text value is not a well-formed XML document</p></td></tr><tr><td><p class="para" id="error-XD0057"><a name="error-XD0057"><!----></a><a href="../error-codes.html#error-XD0057"><span class="link"><code class="code">XD0057</code></span></a></p></td><td><p class="para">It is a dynamic error if the text document does not conform to the JSON grammar, unless the parameter liberal is true and the processor
        chooses to accept the deviation.</p></td></tr><tr><td><p class="para" id="error-XD0058"><a name="error-XD0058"><!----></a><a href="../error-codes.html#error-XD0058"><span class="link"><code class="code">XD0058</code></span></a></p></td><td><p class="para">It is a dynamic error if the parameter duplicates is reject and the text document contains a JSON object with duplicate keys.</p></td></tr><tr><td><p class="para" id="error-XD0059"><a name="error-XD0059"><!----></a><a href="../error-codes.html#error-XD0059"><span class="link"><code class="code">XD0059</code></span></a></p></td><td><p class="para">It is a dynamic error if the parameter map contains an entry whose key is defined in the specification of
          <code class="function">fn:parse-json</code> and whose value is not valid for that key, or if it contains an entry with the key fallback when the
        parameter <code class="literal">escape</code> with <code class="literal">true()</code> is also present.</p></td></tr><tr><td><p class="para" id="error-XD0060"><a name="error-XD0060"><!----></a><a href="../error-codes.html#error-XD0060"><span class="link"><code class="code">XD0060</code></span></a></p></td><td><p class="para">It is a dynamic error if the text document can not be converted into the XPath data model</p></td></tr><tr><td><p class="para" id="error-XD0079"><a name="error-XD0079"><!----></a><a href="../error-codes.html#error-XD0079"><span class="link"><code class="code">XD0079</code></span></a></p></td><td><p class="para">It is a dynamic error if a supplied content-type is not a valid media type of the form “<code class="literal"><code class="replaceable italic">type</code>/<code class="replaceable italic">subtype</code>+<code class="replaceable italic">ext</code></code>” or “<code class="literal"><code class="replaceable italic">type</code>/<code class="replaceable italic">subtype</code></code>”.</p></td></tr></tbody></table></div></div><div class="sect2" id="sect2-d286e20605"><a name="sect2-d286e20605"><!----></a><h2 class="sect2">Reference information</h2><p class="para">This description of the <code class="code step">p:cast-content-type</code> step is for XProc version: <a href="index.html"><span class="link">3.1</span></a>. This is a required step (an XProc 3.1 processor must support this).</p><p class="para">The formal specification for the <code class="code step">p:cast-content-type</code> step can be found <a href="https://spec.xproc.org/lastcall-2024-08/head/steps/#c.cast-content-type" target="_blank"><span class="link newpage">here</span></a>.</p><p class="para">The <code class="code step">p:cast-content-type</code> step is part of categories:</p><ul class="itemizedlist"><li><p class="para"><a href="Standard_XProc_steps.html"><span class="link">Standard XProc steps</span></a></p></li><li><p class="para"><a href="Miscellaneous.html"><span class="link">Miscellaneous</span></a></p></li></ul><p class="para">The <code class="code step">p:cast-content-type</code> step is also present in version:
                <a href="../3.0/p.cast-content-type.html"><span class="link">3.0</span></a>.</p></div></div></div><p>&nbsp;</p></body></html>