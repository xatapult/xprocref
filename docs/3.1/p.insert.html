<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xtlcon="http://www.xtpxlib.nl/ns/container"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link href="../css/bootstrap.min.css" rel="stylesheet"><link href="../css/xprocref.css" rel="stylesheet"><script defer src="../js/bootstrap.bundle.min.js"></script><title>&nbsp;p:insert (3.1)&nbsp;</title><link rel="shortcut icon" href="../images/favicon.ico"></head><body><nav class="navbar navbar-expand-sm bg-secondary navbar-dark "><div class="container-fluid"><a class="navbar-brand" href="../index.html"><img src="../images/logo.png" class="img-fluid" width="18%"></a></div><div class="container-fluid"><ul class="nav justify-content-end nav-pills text-light"><li class="nav-item lead"><a class="nav-link text-light" href="../index.html">home</a></li><li class="nav-item lead"><a class="nav-link text-light" href="../3.0/categories.html">categories</a></li><li class="nav-item dropdown lead"><a class="nav-link dropdown-toggle text-light" data-bs-toggle="dropdown" href="#">info</a><ul class="dropdown-menu"><li class="lead"><a class="dropdown-item" href="../versions.html">versions</a></li><li class="lead"><a class="dropdown-item" href="../error-codes.html">error codes</a></li><li class="lead"><a class="dropdown-item" href="../namespaces.html">namespaces</a></li><li class="lead"><a class="dropdown-item" href="https://xproc.org">XProc</a></li></ul></li><li class="nav-item lead"><a class="nav-link text-light" href="../about.html">about</a></li></ul></div></nav><div class="container pt-5"><p class="para page-banner">This site is work in progress and therefore incomplete yet.</p><div class="sect1" id="sect1-d366e32258"><a name="sect1-d366e32258"><!----></a><h1 class="sect1"><a href="p.identity.html"><span class="link"><img src="../images/previous.png" class="inlinemediaobject next-prev-marker" width="1.5%"></span></a>&nbsp;p:insert (3.1)&nbsp;<a href="p.json-join.html"><span class="link"><img src="../images/next.png" class="inlinemediaobject next-prev-marker" width="1.5%"></span></a></h1><p class="para">Inserts one document into another.</p><ul class="itemizedlist toc toc-2"><li><p class="para tocentry tocentry-2"><a href="#sect2-d366e32271"><span class="link">Summary</span></a></p></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d366e32456"><span class="link">Description</span></a></p><ul class="itemizedlist toc toc-3"><li><p class="para tocentry tocentry-3"><a href="#position-option"><span class="link">The position option</span></a></p></li></ul></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d366e32626"><span class="link">Examples</span></a></p><ul class="itemizedlist toc toc-3"><li><p class="para tocentry tocentry-3"><a href="#p_insert-v31-basic-usage"><span class="link">Basic usage</span></a></p></li><li><p class="para tocentry tocentry-3"><a href="#p_insert-v31-multiple-inserts"><span class="link">Inserting multiple times</span></a></p></li><li><p class="para tocentry tocentry-3"><a href="#p_insert-v31-inserting-text"><span class="link">Inserting text</span></a></p></li></ul></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d366e32674"><span class="link">Additional details</span></a></p></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d366e32718"><span class="link">Errors raised</span></a></p></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d366e32778"><span class="link">Reference information</span></a></p></li></ul><div class="sect2" id="sect2-d366e32271"><a name="sect2-d366e32271"><!----></a><h2 class="sect2">Summary</h2><div class="programlisting step-signature"><pre class="programlisting step-signature">&lt;p:declare-step type="p:insert"&gt;
  &lt;input port="source" primary="true" content-types="xml html" sequence="false"/&gt;
  &lt;output port="result" primary="true" content-types="xml html text" sequence="false"/&gt;
  &lt;input port="insertion" primary="false" content-types="xml html text" sequence="true"/&gt;
  &lt;option name="match" as="xs:string" required="false" select="'/*'"/&gt;
  &lt;option name="position" as="xs:string" required="false" select="'after'" values="('first-child','last-child','before','after')"/&gt;
&lt;/p:declare-step&gt;</pre></div><p class="para">The <code class="code step">p:insert</code> step inserts the document(s) appearing on the <code class="code">insertion</code> port into the document appearing on the <code class="code port">source</code>
      port.</p><p class="para table-header">Ports:</p><div class="table nonumber ports-table"><table class="table nonumber ports-table"><thead><tr><th><p class="para">Type</p></th><th><p class="para">Port</p></th><th><p class="para">Primary?</p></th><th><p class="para">Content types</p></th><th><p class="para">Seq?</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code">input</code></p></td><td><p class="para"><code class="code">source</code></p></td><td><p class="para"><code class="code">true</code></p></td><td><p class="para"><code class="code">xml html</code></p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para">The base document to insert <span class="emphasis italic">in</span>.</p></td></tr><tr><td><p class="para"><code class="code">output</code></p></td><td><p class="para"><code class="code">result</code></p></td><td><p class="para"><code class="code">true</code></p></td><td><p class="para"><code class="code">xml html text</code></p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para">The resulting document</p></td></tr><tr><td><p class="para"><code class="code">input</code></p></td><td><p class="para"><code class="code">insertion</code></p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para"><code class="code">xml html text</code></p></td><td><p class="para"><code class="code">true</code></p></td><td><p class="para">The document(s) to insert.</p></td></tr></tbody></table></div><p class="para table-header">Options:</p><div class="table nonumber options-table"><table class="table nonumber options-table"><thead><tr><th><p class="para">Name</p></th><th><p class="para">Type</p></th><th><p class="para">Req?</p></th><th><p class="para">Default</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code">match</code></p></td><td><p class="para"><code class="code">xs:string</code> (XSLT selection pattern)</p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para"><code class="code">/*</code></p></td><td><p class="para">The XSLT match pattern that indicates where to insert.</p></td></tr><tr><td><p class="para"><code class="code">position</code></p></td><td><p class="para"><code class="code">xs:string</code></p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para"><code class="code">after</code></p></td><td><p class="para">Where to insert, relative to what was matched by the <code class="code option">match</code> option. See <a href="#position-option" class="xref">The position option</a>.</p></td></tr></tbody></table></div></div><div class="sect2" id="sect2-d366e32456"><a name="sect2-d366e32456"><!----></a><h2 class="sect2">Description</h2><p class="para">The <code class="code step">p:insert</code> step can be used to insert one or more documents into another. It searches the document appearing on its <code class="code port">source</code>
      port for matches as indicated by the <code class="code option">match</code> option. It then inserts the document(s) appearing on its <code class="code port">insertion</code>
      port, as indicated by the <code class="code option">position</code> option. The result of the merge is emitted on the <code class="code port">result</code> port.</p><div class="sect3" id="position-option"><a name="position-option"><!----></a><h3 class="sect3">The <code class="code option">position</code> option</h3><p class="para">The <code class="code option">position</code> option tells <code class="code step">p:insert</code> where to insert the document(s) in the <code class="code port">insertion</code> port, relative to what
        was matched by the <code class="code option">match</code> option. There are 4 possible values:</p><div class="table nonumber"><table class="table nonumber"><thead><tr><th><p class="para">Value</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code"><code class="code">first-child</code></code></p></td><td><p class="para">The insertion is made as the <span class="emphasis italic">first child</span> of what was matched. </p></td></tr><tr><td><p class="para"><code class="code"><code class="code">last-child</code></code></p></td><td><p class="para">The insertion is made as the <span class="emphasis italic">last child</span> of what was matched.</p></td></tr><tr><td><p class="para"><code class="code"><code class="code">before</code></code></p></td><td><p class="para">The insertion is made directly <span class="emphasis italic">before</span> what was matched. In other words: the insertion becomes the immediate
                  preceding sibling of the match.</p></td></tr><tr><td><p class="para"><code class="code"><code class="code">after</code></code></p></td><td><p class="para">The insertion is made directly <span class="emphasis italic">after</span> what was matched. In other words: the insertion becomes the immediate
                  following sibling of the match.</p></td></tr></tbody></table></div></div></div><div class="sect2" id="sect2-d366e32626"><a name="sect2-d366e32626"><!----></a><h2 class="sect2">Examples</h2><div class="sect3" id="p_insert-v31-basic-usage"><a name="p_insert-v31-basic-usage"><!----></a><h3 class="sect3">Basic usage</h3><p class="para">This simple example shows how to insert a (for the example, fixed) document into another, as a first child of a match:</p><p class="para keep-with-next">Source document:</p><div class="programlisting"><pre class="programlisting">&lt;things&gt;
   &lt;thing id="123"&gt;USB adapter&lt;/thing&gt;
   &lt;thing id="456"&gt;Joystick&lt;/thing&gt;
   &lt;thing id="789"&gt;Mouse&lt;/thing&gt;
&lt;/things&gt;</pre></div><p class="para keep-with-next">Pipeline document:</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:input port="source"/&gt;
  &lt;p:output port="result"/&gt;

  &lt;p:insert position="first-child"&gt;
    &lt;p:with-input port="insertion"&gt;
      &lt;thing id="999"&gt;Keyboard&lt;/thing&gt;
    &lt;/p:with-input&gt;
  &lt;/p:insert&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para keep-with-next">Result document:</p><div class="programlisting"><pre class="programlisting">&lt;things&gt;
   &lt;thing id="999"&gt;Keyboard&lt;/thing&gt;
   &lt;thing id="123"&gt;USB adapter&lt;/thing&gt;
   &lt;thing id="456"&gt;Joystick&lt;/thing&gt;
   &lt;thing id="789"&gt;Mouse&lt;/thing&gt;
&lt;/things&gt;</pre></div><p class="para">Or, using the same source document, as the its last child:</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:input port="source"/&gt;
  &lt;p:output port="result"/&gt;

  &lt;p:insert position="last-child"&gt;
    &lt;p:with-input port="insertion"&gt;
      &lt;thing id="999"&gt;Keyboard&lt;/thing&gt;
    &lt;/p:with-input&gt;
  &lt;/p:insert&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para keep-with-next">Result document:</p><div class="programlisting"><pre class="programlisting">&lt;things&gt;
   &lt;thing id="123"&gt;USB adapter&lt;/thing&gt;
   &lt;thing id="456"&gt;Joystick&lt;/thing&gt;
   &lt;thing id="789"&gt;Mouse&lt;/thing&gt;
   &lt;thing id="999"&gt;Keyboard&lt;/thing&gt;
&lt;/things&gt;</pre></div><p class="para">The following example, again using the same source document, inserts a new thing using the <code class="code">before</code> value of the
            <code class="code option">position</code> option:</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:input port="source"/&gt;
  &lt;p:output port="result"/&gt;

  &lt;p:insert match="/things/thing[@id eq '456']" position="before"&gt;
    &lt;p:with-input port="insertion"&gt;
      &lt;thing id="999"&gt;Keyboard&lt;/thing&gt;
    &lt;/p:with-input&gt;
  &lt;/p:insert&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para keep-with-next">Result document:</p><div class="programlisting"><pre class="programlisting">&lt;things&gt;
   &lt;thing id="123"&gt;USB adapter&lt;/thing&gt;
   &lt;thing id="999"&gt;Keyboard&lt;/thing&gt;
   &lt;thing id="456"&gt;Joystick&lt;/thing&gt;
   &lt;thing id="789"&gt;Mouse&lt;/thing&gt;
&lt;/things&gt;</pre></div></div><div class="sect3" id="p_insert-v31-multiple-inserts"><a name="p_insert-v31-multiple-inserts"><!----></a><h3 class="sect3">Inserting multiple times</h3><p class="para">The following example shows that when the <code class="code option">match</code> option matches multiple times, the insertion occurs multiple times:</p><p class="para keep-with-next">Source document:</p><div class="programlisting"><pre class="programlisting">&lt;things&gt;
   &lt;thing id="123"&gt;
      &lt;name&gt;USB adapter&lt;/name&gt;
   &lt;/thing&gt;
   &lt;thing id="456"&gt;
      &lt;name&gt;Joystick&lt;/name&gt;
   &lt;/thing&gt;
   &lt;thing id="789"&gt;
      &lt;name&gt;Mouse&lt;/name&gt;
   &lt;/thing&gt;
&lt;/things&gt;</pre></div><p class="para keep-with-next">Pipeline document:</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:input port="source"/&gt;
  &lt;p:output port="result"/&gt;

  &lt;p:insert match="thing" position="last-child"&gt;
    &lt;p:with-input port="insertion"&gt;
      &lt;description&gt;TBD&lt;/description&gt;
    &lt;/p:with-input&gt;
  &lt;/p:insert&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para keep-with-next">Result document:</p><div class="programlisting"><pre class="programlisting">&lt;things&gt;
   &lt;thing id="123"&gt;
      &lt;name&gt;USB adapter&lt;/name&gt;
      &lt;description&gt;TBD&lt;/description&gt;
   &lt;/thing&gt;
   &lt;thing id="456"&gt;
      &lt;name&gt;Joystick&lt;/name&gt;
      &lt;description&gt;TBD&lt;/description&gt;
   &lt;/thing&gt;
   &lt;thing id="789"&gt;
      &lt;name&gt;Mouse&lt;/name&gt;
      &lt;description&gt;TBD&lt;/description&gt;
   &lt;/thing&gt;
&lt;/things&gt;</pre></div></div><div class="sect3" id="p_insert-v31-inserting-text"><a name="p_insert-v31-inserting-text"><!----></a><h3 class="sect3">Inserting text</h3><p class="para">Starting XProc version 3.1, it is also possible to insert text into a document using the <code class="code step">p:insert</code> step:</p><p class="para keep-with-next">Source document:</p><div class="programlisting"><pre class="programlisting">&lt;things&gt;
   &lt;thing id="123"&gt;USB adapter&lt;/thing&gt;
   &lt;thing id="456"&gt;Joystick&lt;/thing&gt;
   &lt;thing id="789"&gt;Mouse&lt;/thing&gt;
&lt;/things&gt;</pre></div><p class="para keep-with-next">Pipeline document:</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:input port="source"/&gt;
  &lt;p:output port="result"/&gt;

  &lt;p:insert match="/things/thing[@id eq '456']" position="last-child"&gt;
    &lt;p:with-input port="insertion"&gt;
     &lt;p:inline content-type="text/plain"&gt; (special!)&lt;/p:inline&gt;
    &lt;/p:with-input&gt;
  &lt;/p:insert&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para keep-with-next">Result document:</p><div class="programlisting"><pre class="programlisting">&lt;things&gt;
   &lt;thing id="123"&gt;USB adapter&lt;/thing&gt;
   &lt;thing id="456"&gt;Joystick (special!)&lt;/thing&gt;
   &lt;thing id="789"&gt;Mouse&lt;/thing&gt;
&lt;/things&gt;</pre></div></div></div><div class="sect2" id="sect2-d366e32674"><a name="sect2-d366e32674"><!----></a><h2 class="sect2">Additional details</h2><ul class="itemizedlist"><li><p class="para">It must be possible to insert the document(s) at the indicated location(s). For instance, the <code class="code option">match</code> option cannot match an
      attribute and you cannot insert something before or after the document node. If this happens, an appropriate error is raised.</p></li><li><p class="para"><code class="code step">p:insert</code> preserves all document-properties of the document(s) appearing on its <code class="code port">source</code> port.</p><p class="para">The document-properties of the document(s) appearing on its <code class="code port">insertion</code> port are not used/preserved.</p></li><li><p class="para">If the <code class="code option">match</code> option matches multiple times, multiple instances of the document(s) on the <code class="code port">insertion</code> port are
      inserted. See <a href="#p_insert-v31-multiple-inserts"><span class="link">Inserting multiple times</span></a>.</p></li><li><p class="para">If the <code class="code port">insertion</code> port receives no document(s), nothing happens. The step will act as a <code class="code step"><a href="p.identity.html"><span class="link">p:identity</span></a></code>
      step.</p></li></ul></div><div class="sect2" id="sect2-d366e32718"><a name="sect2-d366e32718"><!----></a><h2 class="sect2">Errors raised</h2><div class="table nonumber error-codes-table"><table class="table nonumber error-codes-table"><thead><tr><th><p class="para">Error code</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para" id="error-XC0023"><a name="error-XC0023"><!----></a><a href="../error-codes.html#error-XC0023"><span class="link"><code class="code">XC0023</code></span></a></p></td><td><p class="para">It is a dynamic error if the selection pattern matches a wrong type of node.</p></td></tr><tr><td><p class="para" id="error-XC0024"><a name="error-XC0024"><!----></a><a href="../error-codes.html#error-XC0024"><span class="link"><code class="code">XC0024</code></span></a></p></td><td><p class="para">It is a dynamic error if the selection pattern matches a document node and the value of the <code class="code option">position</code> is
          “<code class="literal">before</code>” or “<code class="literal">after</code>”.</p></td></tr><tr><td><p class="para" id="error-XC0025"><a name="error-XC0025"><!----></a><a href="../error-codes.html#error-XC0025"><span class="link"><code class="code">XC0025</code></span></a></p></td><td><p class="para">It is a dynamic error if the selection pattern matches anything other than an element or a document node and the value of the
          <code class="code option">position</code> option is “<code class="literal">first-child</code>” or “<code class="literal">last-child</code>”.</p></td></tr></tbody></table></div></div><div class="sect2" id="sect2-d366e32778"><a name="sect2-d366e32778"><!----></a><h2 class="sect2">Reference information</h2><p class="para">This description of the <code class="code step">p:insert</code> step is for XProc version: <a href="index.html"><span class="link">3.1</span></a>. This is a required step (an XProc 3.1 processor must support this).</p><p class="para">The formal specification for the <code class="code step">p:insert</code> step can be found <a href="https://spec.xproc.org/lastcall-2024-08/head/steps/#c.insert" target="_blank"><span class="link newpage">here</span></a>.</p><p class="para">The <code class="code step">p:insert</code> step is part of categories:</p><ul class="itemizedlist"><li><p class="para"><a href="Standard_XProc_steps.html"><span class="link">Standard XProc steps</span></a></p></li><li><p class="para"><a href="Basic_XML_manipulation.html"><span class="link">Basic XML manipulation</span></a></p></li></ul><p class="para">The <code class="code step">p:insert</code> step is also present in version:
                <a href="../3.0/p.insert.html"><span class="link">3.0</span></a>.</p></div></div></div><p>&nbsp;</p></body></html>