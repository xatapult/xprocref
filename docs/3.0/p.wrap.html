<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xtlcon="http://www.xtpxlib.nl/ns/container"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="keywords" content="xproc xprocref xml step p:wrap wrap element node"><link href="../css/bootstrap.min.css" rel="stylesheet"><link href="../css/xprocref.css" rel="stylesheet"><script defer src="../js/bootstrap.bundle.min.js"></script><title>&nbsp;p:wrap (3.0)&nbsp;</title><link rel="shortcut icon" href="../images/favicon.ico"></head><body><nav class="navbar navbar-expand-sm bg-secondary navbar-dark "><div class="container-fluid"><a class="navbar-brand" href="../index.html"><img src="../images/logo.png" class="img-fluid" width="18%"></a></div><div class="container-fluid"><ul class="nav justify-content-end nav-pills text-light"><li class="nav-item lead"><a class="nav-link text-light" href="../index.html">home</a></li><li class="nav-item lead"><a class="nav-link text-light" href="../3.1/categories.html">categories</a></li><li class="nav-item dropdown lead"><a class="nav-link dropdown-toggle text-light" data-bs-toggle="dropdown" href="#">info</a><ul class="dropdown-menu"><li class="lead"><a class="dropdown-item" href="../versions.html">versions</a></li><li class="lead"><a class="dropdown-item" href="../error-codes.html">error codes</a></li><li class="lead"><a class="dropdown-item" href="../namespaces.html">namespaces</a></li><li class="lead"><a class="dropdown-item" href="https://xproc.org">XProc</a></li></ul></li><li class="nav-item lead"><a class="nav-link text-light" href="../about.html">about</a></li></ul></div></nav><div class="container pt-5"><div class="sect1" id="sect1-d642e75910"><a name="sect1-d642e75910"><!----></a><h1 class="sect1"><a href="p.validate-with-xml-schema.html"><span class="link"><img src="../images/previous.png" class="inlinemediaobject next-prev-marker" width="1.5%"></span></a>&nbsp;p:wrap (3.0)&nbsp;<a href="p.wrap-sequence.html"><span class="link"><img src="../images/next.png" class="inlinemediaobject next-prev-marker" width="1.5%"></span></a></h1><p class="para">Wraps nodes in a parent element.</p><ul class="itemizedlist toc toc-2"><li><p class="para tocentry tocentry-2"><a href="#sect2-d642e75923"><span class="link">Summary</span></a></p></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d642e76098"><span class="link">Description</span></a></p><ul class="itemizedlist toc toc-3"><li><p class="para tocentry tocentry-3"><a href="#grouping"><span class="link">Grouping</span></a></p></li></ul></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d642e76194"><span class="link">Examples</span></a></p><ul class="itemizedlist toc toc-3"><li><p class="para tocentry tocentry-3"><a href="#sect3-d642e76197"><span class="link">Basic usage</span></a></p></li><li><p class="para tocentry tocentry-3"><a href="#p_wrap-v30-ws-grouping"><span class="link">Grouping and wrapping</span></a></p></li><li><p class="para tocentry tocentry-3"><a href="#sect3-d642e76254"><span class="link">Replacing comments by elements</span></a></p></li></ul></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d642e76269"><span class="link">Additional details</span></a></p></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d642e76283"><span class="link">Errors raised</span></a></p></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d642e76307"><span class="link">Reference information</span></a></p></li></ul><div class="sect2" id="sect2-d642e75923"><a name="sect2-d642e75923"><!----></a><h2 class="sect2">Summary</h2><div class="programlisting step-signature"><pre class="programlisting step-signature">&lt;p:declare-step type="p:wrap"&gt;
  &lt;input port="source" primary="true" content-types="xml html" sequence="false"/&gt;
  &lt;output port="result" primary="true" content-types="application/xml" sequence="false"/&gt;
  &lt;option name="match" as="xs:string" required="true"/&gt;
  &lt;option name="wrapper" as="xs:QName" required="true"/&gt;
  &lt;option name="group-adjacent" as="xs:string?" required="false" select="()"/&gt;
&lt;/p:declare-step&gt;</pre></div><p class="para">The <code class="code step">p:wrap</code> step wraps matching nodes in the document on the <code class="code port">source</code> into a new parent element.</p><p class="para table-header">Ports:</p><div class="table nonumber ports-table"><table class="table nonumber ports-table"><thead><tr><th><p class="para">Port</p></th><th><p class="para">Type</p></th><th><p class="para">Primary?</p></th><th><p class="para">Content types</p></th><th><p class="para">Seq?</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code">source</code></p></td><td><p class="para"><code class="code">input</code></p></td><td><p class="para"><code class="code">true</code></p></td><td><p class="para"><code class="code">xml html</code></p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para">The document that contains the nodes to wrap.</p></td></tr><tr><td><p class="para"><code class="code">result</code></p></td><td><p class="para"><code class="code">output</code></p></td><td><p class="para"><code class="code">true</code></p></td><td><p class="para"><code class="code">application/xml</code></p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para">The resulting document.</p></td></tr></tbody></table></div><p class="para table-header">Options:</p><div class="table nonumber options-table"><table class="table nonumber options-table"><thead><tr><th><p class="para">Name</p></th><th><p class="para">Type</p></th><th><p class="para">Req?</p></th><th><p class="para">Default</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code">match</code></p></td><td><p class="para"><code class="code">xs:string</code> (XSLT selection pattern)</p></td><td><p class="para"><code class="code">true</code></p></td><td><p class="para"><code class="code">&nbsp;</code></p></td><td><p class="para">The XSLT match pattern for the nodes to wrap, as a string. This must match either the document-node, an element, a
          processing-instruction, or a comment. If any other kind of node is matched, error <code class="code"><a href="#error-XC0023"><span class="link">XC0023</span></a></code> is raised.</p></td></tr><tr><td><p class="para"><code class="code">wrapper</code></p></td><td><p class="para"><code class="code">xs:QName</code></p></td><td><p class="para"><code class="code">true</code></p></td><td><p class="para"><code class="code">&nbsp;</code></p></td><td><p class="para">The name of the wrapping element.</p></td></tr><tr><td><p class="para"><code class="code">group-adjacent</code></p></td><td><p class="para"><code class="code">xs:string?</code> (XPath expression)</p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para"><code class="code">()</code></p></td><td><p class="para">An XPath expression to use for grouping the wrapped elements. See <a href="#grouping" class="xref">Grouping</a> below.</p></td></tr></tbody></table></div></div><div class="sect2" id="sect2-d642e76098"><a name="sect2-d642e76098"><!----></a><h2 class="sect2">Description</h2><p class="para">The <code class="code step">p:wrap</code> step takes the XSLT match pattern in the <code class="code option">match</code> option and holds this against the document appearing on its
        <code class="code port">source</code> port. This pattern must match the document-node, an element, a processing-instruction, or a comment. The matched node is
      wrapped in an element, as specified in the <code class="code option">wrapper</code> option.</p><p class="para">The <code class="code step">p:wrap</code> step perform a “deep” wrapping: the children of any matched node are also processed. Wrappers are added to
        <span class="emphasis italic">all</span> matching nodes.</p><p class="para">You can’t use <code class="code step">p:wrap</code> to wrap a text document. For this use <code class="code step"><a href="p.wrap-sequence.html"><span class="link">p:wrap-sequence</span></a></code>.</p><div class="sect3" id="grouping"><a name="grouping"><!----></a><h3 class="sect3">Grouping</h3><p class="para">The <code class="code option">group-adjacent</code> option of <code class="code step">p:wrap</code> allows you to group adjacent matching nodes in a single wrapper element. The value
        of this option must a valid XPath expression. It is evaluated for every node in the source document. Adjacent nodes with an equal result value
        are wrapped together in the same wrapper element.</p><p class="para">For all nodes in the document on the <code class="code port">source</code> port:</p><ul class="itemizedlist"><li><p class="para">The node becomes the context item (accessible with the dot <code class="code">.</code> operator).</p></li><li><p class="para">The expression in the <code class="code option">group-adjacent</code> option is evaluated.</p></li><li><p class="para">Two values of sibling nodes, computed by the XPath expression, are considered equal if the XPath function <a href="https://www.w3.org/TR/xpath-functions-31/#func-deep-equal" target="_blank"><span class="link newpage"><code class="code">deep-equal()</code></span></a> returns
              <code class="code">true</code> for them. In most cases this simply means that values are equal when you intuitively expect them to be.</p></li><li><p class="para">All sibling nodes with equal values for the XPath expression, that are adjacent, are wrapped together in a wrapper element, as named
            by the <code class="code option">wrapper</code> option.</p></li></ul><p class="para">For an example see <a href="#p_wrap-v30-ws-grouping"><span class="link">Grouping and wrapping</span></a>.</p></div></div><div class="sect2" id="sect2-d642e76194"><a name="sect2-d642e76194"><!----></a><h2 class="sect2">Examples</h2><div class="sect3" id="sect3-d642e76197"><a name="sect3-d642e76197"><!----></a><h3 class="sect3">Basic usage</h3><p class="para">The following example wraps every <code class="code">thing</code> element in a <code class="tag">&lt;computer-part&gt;</code> element:</p><p class="para keep-with-next">Source document:</p><div class="programlisting"><pre class="programlisting">&lt;things&gt;
   &lt;thing name="laptop"/&gt;
   &lt;thing name="desktop"&gt;
      &lt;subthings&gt;
         &lt;thing name="keyboard"/&gt;
         &lt;thing name="mouse"/&gt;
      &lt;/subthings&gt;
   &lt;/thing&gt;
&lt;/things&gt;</pre></div><p class="para keep-with-next">Pipeline document:</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:input port="source" sequence="true"/&gt;
  &lt;p:output port="result" sequence="true"/&gt;

  &lt;p:wrap match="thing" wrapper="computer-part"/&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para keep-with-next">Result document:</p><div class="programlisting"><pre class="programlisting">&lt;things&gt;
   &lt;computer-part&gt;
      &lt;thing name="laptop"/&gt;
   &lt;/computer-part&gt;
   &lt;computer-part&gt;
      &lt;thing name="desktop"&gt;
         &lt;subthings&gt;
            &lt;computer-part&gt;
               &lt;thing name="keyboard"/&gt;
            &lt;/computer-part&gt;
            &lt;computer-part&gt;
               &lt;thing name="mouse"/&gt;
            &lt;/computer-part&gt;
         &lt;/subthings&gt;
      &lt;/thing&gt;
   &lt;/computer-part&gt;
&lt;/things&gt;</pre></div><p class="para">Please notice that the nested <code class="tag">&lt;thing&gt;</code> elements (inside the <code class="tag">&lt;subthings&gt;</code> element) are also wrapped. This is because <code class="code step">p:wrap</code>
      performs “deep” wrapping.</p></div><div class="sect3" id="p_wrap-v30-ws-grouping"><a name="p_wrap-v30-ws-grouping"><!----></a><h3 class="sect3">Grouping and wrapping</h3><p class="para">This example shows what happens when you use the <code class="code option">group-adjacent</code> option. Here we group fruits by color:</p><p class="para keep-with-next">Source document:</p><div class="programlisting"><pre class="programlisting">&lt;fruits&gt;
   &lt;fruit name="banana" color="yellow"/&gt;
   &lt;fruit name="orange" color="orange"/&gt;
   &lt;fruit name="carrot" color="orange"/&gt;
   &lt;fruit name="lemon" color="yellow"/&gt;
&lt;/fruits&gt;</pre></div><p class="para keep-with-next">Pipeline document:</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:input port="source" sequence="true"/&gt;
  &lt;p:output port="result" sequence="true"/&gt;

  &lt;p:wrap match="fruit" wrapper="fruits-by-color" group-adjacent="@color"/&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para keep-with-next">Result document:</p><div class="programlisting"><pre class="programlisting">&lt;fruits&gt;
   &lt;fruits-by-color&gt;
      &lt;fruit color="yellow" name="banana"/&gt;
   &lt;/fruits-by-color&gt;
   &lt;fruits-by-color&gt;
      &lt;fruit color="orange" name="orange"/&gt;
      &lt;fruit color="orange" name="carrot"/&gt;
   &lt;/fruits-by-color&gt;
   &lt;fruits-by-color&gt;
      &lt;fruit color="yellow" name="lemon"/&gt;
   &lt;/fruits-by-color&gt;
&lt;/fruits&gt;</pre></div><p class="para">You might have expected that the result would group the fruits together by color, resulting in groups of elements, wrapped in
        <code class="tag">&lt;fruits-by-color&gt;</code> elements: one for <code class="code">banana</code>+<code class="code">lemon</code> and one for <code class="code">orange</code>+<code class="code">carrot</code>. But
      <code class="code step">p:wrap</code> groups sibling nodes that are <span class="emphasis italic">adjacent</span> to each other only. It does <span class="emphasis italic">not</span> do what would be called
      “group by”: all sibling nodes with the same value for the XPath expression together in a single group. If you need this, you will
      have to sort the document first. But unfortunately, XProc does not have anything on board for that. For more complex grouping, the advice is to
      use XSLT or XQuery.</p></div><div class="sect3" id="sect3-d642e76254"><a name="sect3-d642e76254"><!----></a><h3 class="sect3">Replacing comments by elements</h3><p class="para">This example shows that you can use <code class="code step">p:wrap</code> not only to wrap elements, but also other kinds of nodes. Here we use its functionality,
      together with the <code class="code step"><a href="p.string-replace.html"><span class="link">p:string-replace</span></a></code> step, to change comments into elements. For this, we first wrap every element in a
        <code class="tag">&lt;comment&gt;</code> element and then turn these comments into text nodes using <code class="code step"><a href="p.string-replace.html"><span class="link">p:string-replace</span></a></code>. </p><p class="para keep-with-next">Source document:</p><div class="programlisting"><pre class="programlisting">&lt;examples&gt;
      &lt;!--Comment 1--&gt;
      &lt;!--Another comment…--&gt;
    &lt;/examples&gt;</pre></div><p class="para keep-with-next">Pipeline document:</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:input port="source" sequence="true"/&gt;
  &lt;p:output port="result" sequence="true"/&gt;

  &lt;p:wrap match="comment()" wrapper="comment"/&gt;
  &lt;p:string-replace match="comment/comment()" replace="string(.)"/&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para keep-with-next">Result document:</p><div class="programlisting"><pre class="programlisting">&lt;examples&gt;
   &lt;comment&gt;Comment 1&lt;/comment&gt;
   &lt;comment&gt;Another comment…&lt;/comment&gt;
&lt;/examples&gt;</pre></div></div></div><div class="sect2" id="sect2-d642e76269"><a name="sect2-d642e76269"><!----></a><h2 class="sect2">Additional details</h2><ul class="itemizedlist"><li><p class="para"><code class="code step">p:wrap</code> preserves all document-properties of the document(s) appearing on its <code class="code port">source</code> port.</p></li></ul></div><div class="sect2" id="sect2-d642e76283"><a name="sect2-d642e76283"><!----></a><h2 class="sect2">Errors raised</h2><div class="table nonumber error-codes-table"><table class="table nonumber error-codes-table"><thead><tr><th><p class="para">Error code</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para" id="error-XC0023"><a name="error-XC0023"><!----></a><a href="../error-codes.html#error-XC0023"><span class="link"><code class="code">XC0023</code></span></a></p></td><td><p class="para">It is a dynamic error if the selection pattern matches a wrong type of node.</p></td></tr></tbody></table></div></div><div class="sect2" id="sect2-d642e76307"><a name="sect2-d642e76307"><!----></a><h2 class="sect2">Reference information</h2><p class="para">This description of the <code class="code step">p:wrap</code> step is for XProc version: <a href="index.html"><span class="link">3.0</span></a>. This is a required step (an XProc 3.0 processor must support this).</p><p class="para">The formal specification for the <code class="code step">p:wrap</code> step can be found <a href="https://spec.xproc.org/3.0/steps/#c.wrap" target="_blank"><span class="link newpage">here</span></a>.</p><p class="para">The <code class="code step">p:wrap</code> step is part of categories:</p><ul class="itemizedlist"><li><p class="para"><a href="Standard_XProc_steps.html"><span class="link">Standard XProc steps</span></a></p></li><li><p class="para"><a href="Basic_XML_manipulation.html"><span class="link">Basic XML manipulation</span></a></p></li></ul><p class="para">The <code class="code step">p:wrap</code> step is also present in version:
                <a href="../3.1/p.wrap.html"><span class="link">3.1</span></a>.</p></div></div></div><p>&nbsp;</p></body></html>