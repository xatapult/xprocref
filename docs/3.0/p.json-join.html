<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xtlcon="http://www.xtpxlib.nl/ns/container"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link href="../css/bootstrap.min.css" rel="stylesheet"><link href="../css/xprocref.css" rel="stylesheet"><script defer src="../js/bootstrap.bundle.min.js"></script><title>&nbsp;p:json-join (3.0)&nbsp;</title><link rel="shortcut icon" href="../images/favicon.ico"></head><body><nav class="navbar navbar-expand-sm bg-secondary navbar-dark "><div class="container-fluid"><a class="navbar-brand" href="../index.html"><img src="../images/logo.png" class="img-fluid" width="18%"></a></div><div class="container-fluid"><ul class="nav justify-content-end nav-pills text-light"><li class="nav-item lead"><a class="nav-link text-light" href="../index.html">home</a></li><li class="nav-item lead"><a class="nav-link text-light" href="../3.0/categories.html">categories</a></li><li class="nav-item dropdown lead"><a class="nav-link dropdown-toggle text-light" data-bs-toggle="dropdown" href="#">info</a><ul class="dropdown-menu"><li class="lead"><a class="dropdown-item" href="../versions.html">versions</a></li><li class="lead"><a class="dropdown-item" href="../error-codes.html">error codes</a></li><li class="lead"><a class="dropdown-item" href="../namespaces.html">namespaces</a></li><li class="lead"><a class="dropdown-item" href="https://xproc.org">XProc</a></li></ul></li><li class="nav-item lead"><a class="nav-link text-light" href="../about.html">about</a></li></ul></div></nav><div class="container pt-5"><p class="para page-banner">This site is work in progress and does not yet describe all available steps.</p><div class="sect1" id="sect1-d420e13181"><a name="sect1-d420e13181"><!----></a><h1 class="sect1"><a href="p.insert.html"><span class="link"><img src="../images/previous.png" class="inlinemediaobject next-prev-marker" width="1.5%"></span></a>&nbsp;p:json-join (3.0)&nbsp;<a href="p.json-merge.html"><span class="link"><img src="../images/next.png" class="inlinemediaobject next-prev-marker" width="1.5%"></span></a></h1><p class="para">Joins documents into a JSON array document.</p><ul class="itemizedlist toc toc-2"><li><p class="para tocentry tocentry-2"><a href="#sect2-d420e13194"><span class="link">Summary</span></a></p></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d420e13339"><span class="link">Description</span></a></p><ul class="itemizedlist toc toc-3"><li><p class="para tocentry tocentry-3"><a href="#flattening"><span class="link">Flattening arrays</span></a></p></li></ul></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d420e13460"><span class="link">Examples</span></a></p><ul class="itemizedlist toc toc-3"><li><p class="para tocentry tocentry-3"><a href="#sect3-d420e13463"><span class="link">Basic usage</span></a></p></li><li><p class="para tocentry tocentry-3"><a href="#p_json-join-v30-flattening-example"><span class="link">Flattening arrays</span></a></p></li></ul></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d420e13529"><span class="link">Additional details</span></a></p></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d420e13551"><span class="link">Errors raised</span></a></p></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d420e13596"><span class="link">Reference information</span></a></p></li></ul><div class="sect2" id="sect2-d420e13194"><a name="sect2-d420e13194"><!----></a><h2 class="sect2">Summary</h2><div class="programlisting step-signature"><pre class="programlisting step-signature">&lt;p:declare-step type="p:json-join"&gt;
  &lt;input port="source" primary="true" content-types="any" sequence="true"/&gt;
  &lt;output port="result" primary="true" content-types="application/json" sequence="false"/&gt;
  &lt;option name="flatten-to-depth" as="xs:string?" required="false" select="'0'"/&gt;
&lt;/p:declare-step&gt;</pre></div><p class="para">The <code class="code step">p:json-join</code> step joins the document(s) appearing on the <code class="code port">source</code> port into a JSON array. This array is returned as a single JSON
      document on the <code class="code port">result</code> port.</p><p class="para table-header">Ports:</p><div class="table nonumber ports-table"><table class="table nonumber ports-table"><thead><tr><th><p class="para">Type</p></th><th><p class="para">Port</p></th><th><p class="para">Primary?</p></th><th><p class="para">Content types</p></th><th><p class="para">Seq?</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code">input</code></p></td><td><p class="para"><code class="code">source</code></p></td><td><p class="para"><code class="code">true</code></p></td><td><p class="para"><code class="code">any</code></p></td><td><p class="para"><code class="code">true</code></p></td><td><p class="para">The documents to join.</p></td></tr><tr><td><p class="para"><code class="code">output</code></p></td><td><p class="para"><code class="code">result</code></p></td><td><p class="para"><code class="code">true</code></p></td><td><p class="para"><code class="code">application/json</code></p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para">The resulting JSON array document containing the source documents.</p></td></tr></tbody></table></div><p class="para table-header">Options:</p><div class="table nonumber options-table"><table class="table nonumber options-table"><thead><tr><th><p class="para">Name</p></th><th><p class="para">Type</p></th><th><p class="para">Req?</p></th><th><p class="para">Default</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code">flatten-to-depth</code></p></td><td><p class="para"><code class="code">xs:string?</code></p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para"><code class="code">0</code></p></td><td><p class="para">Specifies whether and to which depth JSON source documents that are arrays must be “flattened”. See <a href="#flattening" class="xref">Flattening arrays</a>.</p><p class="para">Please notice that the data type of this option is <code class="code">xs:string</code> (and not <code class="code">xs:integer</code> as you might expect). This is
          because it can also take the value <code class="code">unbounded</code>. </p></td></tr></tbody></table></div></div><div class="sect2" id="sect2-d420e13339"><a name="sect2-d420e13339"><!----></a><h2 class="sect2">Description</h2><p class="para">The <code class="code step">p:json-join</code> step takes the document(s) appearing on its <code class="code port">source</code> port and joins them into a JSON array. How the source documents
      end up in the resulting array depends on their type:</p><ul class="itemizedlist"><li><p class="para">A JSON source document that is <span class="emphasis italic">not</span> an array is added to the result as a member of the resulting array.</p></li><li><p class="para">A JSON source document that is itself an array is also added to the resulting array. However, depending on the value of the
            <code class="code option">flatten-to-depth</code> option, additional “flattening” can happen. See <a href="#flattening" class="xref">Flattening arrays</a>.</p></li><li><p class="para">An XML, HTML or text document is first serialized (as if written to disk) and then added as a string to the resulting array.</p></li><li><p class="para">Whether <code class="code step">p:json-join</code> can handle any other media types is implementation-defined and therefore dependent on the XProc processor used.</p></li></ul><p class="para">The resulting array is emitted as a single JSON document on the <code class="code port">result</code> port.</p><div class="sect3" id="flattening"><a name="flattening"><!----></a><h3 class="sect3">Flattening arrays</h3><p class="para">Depending on the value of the <code class="code option">flatten-to-depth</code> option, ”flattening” of the resulting array takes place.
        Flattening here means that if there are members of the resulting array that are itself arrays, their members will appear as individual members
        in the final result. For instance, flattening <code class="code">["a",&nbsp;"b",&nbsp;["c",&nbsp;"d"]&nbsp;]</code> results in
          <code class="code">["a",&nbsp;"b",&nbsp;"c",&nbsp;"d"]</code>.</p><p class="para">What happens exactly depends on the value of the <code class="code option">flatten-to-depth</code> option:</p><ul class="itemizedlist"><li><p class="para">If <code class="code">0</code> (default), no flattening takes place.</p></li><li><p class="para">If <code class="code">1</code>, any array on the <code class="code port">source</code> port is flattened into the final result.</p></li><li><p class="para">If greater than <code class="code">1</code>, flattening is applied recursively to arrays in arrays, up to the given depth. </p></li><li><p class="para">If <code class="code">unbounded</code>, all arrays are flattened.</p></li></ul><p class="para">See <a href="#p_json-join-v30-flattening-example"><span class="link">Flattening arrays</span></a> for an example.</p></div></div><div class="sect2" id="sect2-d420e13460"><a name="sect2-d420e13460"><!----></a><h2 class="sect2">Examples</h2><div class="sect3" id="sect3-d420e13463"><a name="sect3-d420e13463"><!----></a><h3 class="sect3">Basic usage</h3><p class="para">The following pipeline produces a sequence of 3 documents on the <code class="code port">source</code> port of <code class="code step">p:json-join</code>: An XML, a text and a JSON
          document. This is merrily joined into a single array:</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:input port="source" sequence="true"&gt;
    &lt;p:inline&gt;&lt;some-xml a="b"/&gt;&lt;/p:inline&gt;
    &lt;p:inline content-type="text/plain"&gt;Hello there!&lt;/p:inline&gt;
    &lt;p:inline content-type="application/json" expand-text="false"&gt;{"key": 12345}&lt;/p:inline&gt;
  &lt;/p:input&gt;
  &lt;p:output port="result"/&gt;

  &lt;p:json-join/&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para keep-with-next">Result document:</p><div class="programlisting"><pre class="programlisting">["&lt;some-xml a=\"b\"\/&gt;","Hello there!",{"key":12345}]</pre></div></div><div class="sect3" id="p_json-join-v30-flattening-example"><a name="p_json-join-v30-flattening-example"><!----></a><h3 class="sect3">Flattening arrays</h3><p class="para">The following pipeline produces a sequence of 2 documents on the <code class="code port">source</code> port of <code class="code step">p:json-join</code>: A JSON text and a JSON array. If
          we do <span class="emphasis italic">not</span> flatten it, the source array will simply appear as a member of the resulting array:</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:input port="source" sequence="true"&gt;
    &lt;p:inline content-type="application/json"&gt;"Hello!"&lt;/p:inline&gt;
    &lt;p:inline content-type="application/json"&gt;["a", "b", ["c", "d"] ]&lt;/p:inline&gt;
  &lt;/p:input&gt;
  &lt;p:output port="result"/&gt;

  &lt;p:json-join/&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para keep-with-next">Result document:</p><div class="programlisting"><pre class="programlisting">["Hello!",["a","b",["c","d"]]]</pre></div><p class="para">By setting the <code class="code option">flatten-to-depth</code> option to <code class="code">1</code>, the source array is flattened:</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:input port="source" sequence="true"&gt;
    &lt;p:inline content-type="application/json"&gt;"Hello!"&lt;/p:inline&gt;
    &lt;p:inline content-type="application/json"&gt;["a", "b", ["c", "d"] ]&lt;/p:inline&gt;
  &lt;/p:input&gt;
  &lt;p:output port="result"/&gt;

  &lt;p:json-join flatten-to-depth="1"/&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para keep-with-next">Result document:</p><div class="programlisting"><pre class="programlisting">["Hello!","a","b",["c","d"]]</pre></div><p class="para">If we increase the <code class="code option">flatten-to-depth</code> option to <code class="code">2</code>, the inner array is also flattened. A value
            <code class="code">unbounded</code> would have had the same effect here.</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:input port="source" sequence="true"&gt;
    &lt;p:inline content-type="application/json"&gt;"Hello!"&lt;/p:inline&gt;
    &lt;p:inline content-type="application/json"&gt;["a", "b", ["c", "d"] ]&lt;/p:inline&gt;
  &lt;/p:input&gt;
  &lt;p:output port="result"/&gt;

  &lt;p:json-join flatten-to-depth="2"/&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para keep-with-next">Result document:</p><div class="programlisting"><pre class="programlisting">["Hello!","a","b","c","d"]</pre></div></div></div><div class="sect2" id="sect2-d420e13529"><a name="sect2-d420e13529"><!----></a><h2 class="sect2">Additional details</h2><ul class="itemizedlist"><li><p class="para">No document-properties of the source document(s) survive.</p></li><li><p class="para">The resulting document has no <code class="code property">base-uri</code> property.</p></li><li><p class="para">If there are no documents appearing on the <code class="code port">source</code> port, the <code class="code port">result</code> port returns the empty sequence.</p></li></ul></div><div class="sect2" id="sect2-d420e13551"><a name="sect2-d420e13551"><!----></a><h2 class="sect2">Errors raised</h2><div class="table nonumber error-codes-table"><table class="table nonumber error-codes-table"><thead><tr><th><p class="para">Error code</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para" id="error-XC0111"><a name="error-XC0111"><!----></a><a href="../error-codes.html#error-XC0111"><span class="link"><code class="code">XC0111</code></span></a></p></td><td><p class="para"> It is a dynamic error if a document of an unsupported document type appears on port <code class="code port">source</code> of
        <code class="code">p:json-join</code>.</p></td></tr><tr><td><p class="para" id="error-XC0119"><a name="error-XC0119"><!----></a><a href="../error-codes.html#error-XC0119"><span class="link"><code class="code">XC0119</code></span></a></p></td><td><p class="para">It is a dynamic error if <code class="code option">flatten</code> is neither “<code class="literal">unbounded</code>”, nor a string that may be cast to a
        non-negative integer.</p></td></tr></tbody></table></div></div><div class="sect2" id="sect2-d420e13596"><a name="sect2-d420e13596"><!----></a><h2 class="sect2">Reference information</h2><p class="para">This description of the <code class="code step">p:json-join</code> step is for XProc version: <a href="../index.html"><span class="link">3.0</span></a>. This is a required step (an XProc 3.0 processor must support this).</p><p class="para">The formal specification for the <code class="code step">p:json-join</code> step can be found <a href="https://spec.xproc.org/3.0/steps/#c.json-join" target="_blank"><span class="link newpage">here</span></a>.</p><p class="para">The <code class="code step">p:json-join</code> step is part of categories:</p><ul class="itemizedlist"><li><p class="para"><a href="Standard_XProc_steps.html"><span class="link">Standard XProc steps</span></a></p></li><li><p class="para"><a href="JSON_related_steps.html"><span class="link">JSON related steps</span></a></p></li></ul><p class="para">The <code class="code step">p:json-join</code> step is also present in version:
                <a href="../3.1/p.json-join.html"><span class="link">3.1</span></a>.</p></div></div></div><p>&nbsp;</p></body></html>