<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xtlcon="http://www.xtpxlib.nl/ns/container"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="keywords" content="xproc xprocref xml step p:xslt xslt"><link href="../css/bootstrap.min.css" rel="stylesheet"><link href="../css/xprocref.css" rel="stylesheet"><script defer src="../js/bootstrap.bundle.min.js"></script><title>&nbsp;p:xslt (3.0)</title><link rel="shortcut icon" href="../images/favicon.ico"></head><body><nav class="navbar navbar-expand-sm bg-secondary navbar-dark "><div class="container-fluid"><a class="navbar-brand" href="../index.html"><img src="../images/logo.png" class="img-fluid" width="18%"></a></div><div class="container-fluid"><ul class="nav justify-content-end nav-pills text-light"><li class="nav-item lead"><a class="nav-link text-light" href="../index.html">home</a></li><li class="nav-item lead"><a class="nav-link text-light" href="../3.0/categories.html">categories</a></li><li class="nav-item dropdown lead"><a class="nav-link dropdown-toggle text-light" data-bs-toggle="dropdown" href="#">info</a><ul class="dropdown-menu"><li class="lead"><a class="dropdown-item" href="../versions.html">versions</a></li><li class="lead"><a class="dropdown-item" href="../error-codes.html">error codes</a></li><li class="lead"><a class="dropdown-item" href="../namespaces.html">namespaces</a></li><li class="lead"><a class="dropdown-item" href="https://xproc.org">XProc</a></li></ul></li><li class="nav-item lead"><a class="nav-link text-light" href="../about.html">about</a></li></ul></div></nav><div class="container pt-5"><div class="sect1" id="sect1-d547e33254"><a name="sect1-d547e33254"><!----></a><h1 class="sect1"><a href="p.xquery.html"><span class="link"><img src="../images/previous.png" class="inlinemediaobject next-prev-marker" width="1.5%"></span></a>&nbsp;p:xslt (3.0)</h1><p class="para">Invoke an XSLT stylesheet.</p><ul class="itemizedlist toc toc-2"><li><p class="para tocentry tocentry-2"><a href="#sect2-d547e33263"><span class="link">Summary</span></a></p></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d547e33631"><span class="link">Description</span></a></p><ul class="itemizedlist toc toc-3"><li><p class="para tocentry tocentry-3"><a href="#sect3-d547e33660"><span class="link">Invoking an XSLT&nbsp;3.0 stylesheet</span></a></p></li><li><p class="para tocentry tocentry-3"><a href="#sect3-d547e33940"><span class="link">Invoking an XSLT&nbsp;2.0 stylesheet</span></a></p></li><li><p class="para tocentry tocentry-3"><a href="#sect3-d547e34199"><span class="link">Invoking an XSLT&nbsp;1.0 stylesheet</span></a></p></li></ul></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d547e34303"><span class="link">Examples</span></a></p><ul class="itemizedlist toc toc-3"><li><p class="para tocentry tocentry-3"><a href="#p_xslt-v30-basic-usage"><span class="link">Basic usage</span></a></p></li><li><p class="para tocentry tocentry-3"><a href="#p_xslt-v30-basic-usage-2"><span class="link">Basic usage with secondary documents</span></a></p></li></ul></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d547e34398"><span class="link">Additional details</span></a></p></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d547e34450"><span class="link">Errors raised</span></a></p></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d547e34576"><span class="link">Reference information</span></a></p></li></ul><div class="sect2" id="sect2-d547e33263"><a name="sect2-d547e33263"><!----></a><h2 class="sect2">Summary</h2><div class="programlisting step-signature"><pre class="programlisting step-signature">&lt;p:declare-step type="p:xslt"&gt;
  &lt;input port="source" primary="true" content-types="any" sequence="true"/&gt;
  &lt;output port="result" primary="true" content-types="any" sequence="true"/&gt;
  &lt;input port="stylesheet" primary="false" content-types="xml" sequence="false"/&gt;
  &lt;output port="secondary" primary="false" content-types="any" sequence="true"/&gt;
  &lt;option name="global-context-item" as="item()?" required="false" select="()"/&gt;
  &lt;option name="initial-mode" as="xs:QName?" required="false" select="()"/&gt;
  &lt;option name="output-base-uri" as="xs:anyURI?" required="false" select="()"/&gt;
  &lt;option name="parameters" as="map(xs:QName,item()*)?" required="false" select="()"/&gt;
  &lt;option name="populate-default-collection" as="xs:boolean?" required="false" select="true()"/&gt;
  &lt;option name="static-parameters" as="map(xs:QName,item()*)?" required="false" select="()"/&gt;
  &lt;option name="template-name" as="xs:QName?" required="false" select="()"/&gt;
  &lt;option name="version" as="xs:string?" required="false" select="()"/&gt;
&lt;/p:declare-step&gt;</pre></div><p class="para">The <code class="code step">p:xslt</code> step invokes the XSLT stylesheet that appears on the <code class="code port">stylesheet</code> port. What exactly happens depends on the XSLT
      version used.</p><p class="para table-header">Ports:</p><div class="table nonumber ports-table"><table class="table nonumber ports-table"><thead><tr><th><p class="para">Port</p></th><th><p class="para">Type</p></th><th><p class="para">Primary?</p></th><th><p class="para">Content types</p></th><th><p class="para">Seq?</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code">source</code></p></td><td><p class="para"><code class="code">input</code></p></td><td><p class="para"><code class="code">true</code></p></td><td><p class="para"><code class="code">any</code></p></td><td><p class="para"><code class="code">true</code></p></td><td><p class="para">The source document(s) to transform. What exactly happens with these documents depends on the XSLT stylesheet version. See below.</p></td></tr><tr><td><p class="para"><code class="code">result</code></p></td><td><p class="para"><code class="code">output</code></p></td><td><p class="para"><code class="code">true</code></p></td><td><p class="para"><code class="code">any</code></p></td><td><p class="para"><code class="code">true</code></p></td><td><p class="para">The principal resulting document(s) of the transformation.</p></td></tr><tr><td><p class="para"><code class="code">stylesheet</code></p></td><td><p class="para"><code class="code">input</code></p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para"><code class="code">xml</code></p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para">The XSLT stylesheet to invoke.</p></td></tr><tr><td><p class="para"><code class="code">secondary</code></p></td><td><p class="para"><code class="code">output</code></p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para"><code class="code">any</code></p></td><td><p class="para"><code class="code">true</code></p></td><td><p class="para">Any secondary documents created by the transformation.</p><p class="para">Starting with XSLT version&nbsp;2.0, you can use the XSLT <code class="tag">&lt;xsl:result-document&gt;</code> instruction for this.</p></td></tr></tbody></table></div><p class="para table-header">Options:</p><div class="table nonumber options-table"><table class="table nonumber options-table"><thead><tr><th><p class="para">Name</p></th><th><p class="para">Type</p></th><th><p class="para">Req?</p></th><th><p class="para">Default</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code">global-context-item</code></p></td><td><p class="para"><code class="code">item()?</code></p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para"><code class="code">()</code></p></td><td><p class="para">This explicitly sets the global context item for the XSLT stylesheet: the data the stylesheet starts working on. If you don’t use
          this option, the global context item is determined by what appears on the <code class="code port">source</code> port.</p><p class="para">Setting the global context item is supported starting XSLT version&nbsp;3.0.</p></td></tr><tr><td><p class="para"><code class="code">initial-mode</code></p></td><td><p class="para"><code class="code">xs:QName?</code></p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para"><code class="code">()</code></p></td><td><p class="para">If this option is set, the XSLT stylesheet starts processing in the given mode.</p><p class="para">Modes are supported starting XSLT version&nbsp;2.0.</p></td></tr><tr><td><p class="para"><code class="code">output-base-uri</code></p></td><td><p class="para"><code class="code">xs:anyURI?</code></p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para"><code class="code">()</code></p></td><td><p class="para">Explicitly sets the base URI for the stylesheet result(s). What exactly happens depends on the XSLT stylesheet version. See
          below.</p></td></tr><tr><td><p class="para"><code class="code">parameters</code></p></td><td><p class="para"><code class="code">map(xs:QName,item()*)?</code></p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para"><code class="code">()</code></p></td><td><p class="para">A map with parameter-names and corresponding values to pass as global parameters to the XSLT stylesheet.</p></td></tr><tr><td><p class="para"><code class="code">populate-default-collection</code></p></td><td><p class="para"><code class="code">xs:boolean?</code></p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para"><code class="code">true</code></p></td><td><p class="para">XSLT stylesheets have a <span class="emphasis italic">default collection</span>, accessible using the XPath <a href="https://www.w3.org/TR/xpath-functions-31/#func-collection" target="_blank"><span class="link newpage">collection()</span></a> function. If you set this option
          to <code class="code">true</code>, the documents appearing on the <code class="code port">source</code> port become the default collection.</p><p class="para">Collections are supported starting XSLT version&nbsp;2.0.</p></td></tr><tr><td><p class="para"><code class="code">static-parameters</code></p></td><td><p class="para"><code class="code">map(xs:QName,item()*)?</code></p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para"><code class="code">()</code></p></td><td><p class="para">A map with parameter-names and corresponding values to pass as static parameters to the XSLT stylesheet.</p><p class="para">Static stylesheet parameters are supported starting XSLT version&nbsp;3.0.</p></td></tr><tr><td><p class="para"><code class="code">template-name</code></p></td><td><p class="para"><code class="code">xs:QName?</code></p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para"><code class="code">()</code></p></td><td><p class="para">Usually, an XSLT stylesheet starts processing using “apply-template invocation”: it tries to find the most appropriate
          matching template and starts processing there. However, if the <code class="code option">template-name</code> option is set, a “call-template
          invocation” is performed: processing starts at that named template.</p><p class="para"></p><p class="para">Starting processing at a named template is supported starting XSLT version&nbsp;2.0.</p></td></tr><tr><td><p class="para"><code class="code">version</code></p></td><td><p class="para"><code class="code">xs:string?</code></p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para"><code class="code">()</code></p></td><td><p class="para">Explicitly sets the XSLT stylesheet version. Probable values are <code class="code">1.0</code>, <code class="code">2.0</code> or <code class="code">3.0</code>.</p><p class="para">If this option is not set, officially the XSLT version used is implementation-defined and therefore depends on the XProc processor used.
          However, most likely the XProc processor will use the stylesheet version as indicated on the stylesheet root element (the
            <code class="code">xsl:stylesheet/@version</code> or <code class="code">xsl:transform/@version</code> attribute).</p></td></tr></tbody></table></div></div><div class="sect2" id="sect2-d547e33631"><a name="sect2-d547e33631"><!----></a><h2 class="sect2">Description</h2><p class="para">The <code class="code step">p:xslt</code> step invokes the XSLT stylesheet that appears on the <code class="code port">stylesheet</code> port. What is used as input, how the XSLT
      processing starts and where/how the results appear depends on the XSLT version used. This is explained in the sections below.</p><p class="para">Because of all the details, invoking the <code class="code step">p:xslt</code> step seems complicated. However, presumably, in the vast majority of cases it will be used
      in a classical manner: invoke an XSLT stylesheet on a source document and continue the pipeline using its result. Maybe with some parameters,
      maybe with some secondary results. For this, have a look at the <a href="#p_xslt-v30-basic-usage"><span class="link">Basic usage</span></a> and <a href="#p_xslt-v30-basic-usage-2"><span class="link">Basic usage with secondary documents</span></a>
      examples and don’t let all the details overwhelm you.</p><p class="para">Specifying the XSLT version is important but, in most cases, rather simple: most likely the version as specified on the XSLT stylesheet root
      element (the <code class="code">xsl:stylesheet/@version</code> or <code class="code">xsl:transform/@version</code> attribute) is used. Since such a version attribute is
      required anyway, there usually won’t be anything special you need to do. However, if you want you can set the version explicitly using
      the <code class="code option">version</code> option.</p><div class="sect3" id="sect3-d547e33660"><a name="sect3-d547e33660"><!----></a><h3 class="sect3">Invoking an XSLT&nbsp;3.0 stylesheet</h3><p class="para">If the stylesheet version is determined as 3.0, the following happens:</p><ul class="itemizedlist"><li><p class="para">The parameters as set by the <code class="code option">static-parameters</code> option are passed to the stylesheet invocation as values for its
            static parameters.</p></li><li><p class="para">An XSLT version&nbsp;3.0 stylesheet has a <span class="emphasis italic">global context item</span>, the data the stylesheet works upon. This is
            determined as follows:</p><ul class="itemizedlist"><li><p class="para">If the <code class="code option">global-context-item</code> option is set, this becomes the global context item.</p></li><li><p class="para">If the <code class="code option">global-context-item</code> option is <span class="emphasis italic">not</span> set <span class="emphasis italic">and</span> a single document
                appears on the <code class="code port">source</code> port, this will become the global context item.</p></li><li><p class="para">If the <code class="code option">global-context-item</code> option is <span class="emphasis italic">not</span> set <span class="emphasis italic">and</span> none or multiple
                documents appear on the <code class="code port">source</code> port, the global context item is absent/empty.</p></li></ul></li><li><p class="para">If the <code class="code option">populate-default-collection</code> is set to <code class="code">true</code>, all documents that appear on the <code class="code port">source</code>
            port become the <span class="emphasis italic">default collection</span>, accessible using the XPath <a href="https://www.w3.org/TR/xpath-functions-31/#func-collection" target="_blank"><span class="link newpage">collection()</span></a> function.</p></li><li><p class="para">Then it is determined how to start the stylesheet processing:</p><ul class="itemizedlist"><li><p class="para">If the <code class="code option">template-name</code> is <span class="emphasis italic">not</span> set, the normal “apply-template invocation” is
                performed. The document(s) that appear on the <code class="code port">source</code> port are used, one by one, for the initial match.</p><p class="para">If the <code class="code option">initial-mode</code> option is set, processing starts in that mode.</p></li><li><p class="para">If the <code class="code option">template-name</code> is set, the named template with that name (<code class="tag">&lt;xsl:template name="…"&gt;</code>) is
                invoked.</p><p class="para">The <code class="code option">initial-mode</code> option is ignored.</p></li></ul></li><li><p class="para">The stylesheet processes.</p></li><li><p class="para">The result(s) appears on the output port(s):</p><ul class="itemizedlist"><li><p class="para">All principal results of the stylesheet appear on the <code class="code port">result</code> port.</p></li><li><p class="para">Any results created by <code class="tag">&lt;xsl:result-document&gt;</code> instructions appear on the <code class="code port">secondary</code> port. </p></li></ul></li><li><p class="para">Finally, the base URIs of the resulting documents (their <code class="code property">base-uri</code> document-property values) are determined. For
            this we first need to determine the <span class="emphasis italic">base-output-URI</span>:</p><ul class="itemizedlist"><li><p class="para">If the <code class="code option">base-output-uri</code> option is set, this value is used as base-output-URI.</p></li><li><p class="para">If the <code class="code option">base-output-uri</code> option is <span class="emphasis italic">not</span> set <span class="emphasis italic">and</span> there are documents on the
                  <code class="code port">source</code> port, the base URI of the <span class="emphasis italic">first</span> document on the <code class="code port">source</code> port is used as base
                output URI.</p></li><li><p class="para">If the <code class="code option">base-output-uri</code> option is <span class="emphasis italic">not</span> set <span class="emphasis italic">and</span> there are
                  <span class="emphasis italic">no</span> documents on the <code class="code port">source</code> port, the base URI of the stylesheet is used as base-output-URI.</p></li></ul><p class="para">The base URIs of the resulting documents (their <code class="code property">base-uri</code> document-property values) are now computed using this
            base-output-URI:</p><ul class="itemizedlist"><li><p class="para">The base URI of the principal output document(s) becomes the base-output-URI. This means that when there are multiple principal
                documents, they all have the same base URI!</p></li><li><p class="para">For all documents appearing on the <code class="code port">secondary</code> port, the base URI is determined by the
                  <code class="code">xsl:result-document/@href</code> attribute. A relative value is made absolute against the base-output-URI.</p></li></ul></li></ul></div><div class="sect3" id="sect3-d547e33940"><a name="sect3-d547e33940"><!----></a><h3 class="sect3">Invoking an XSLT&nbsp;2.0 stylesheet</h3><p class="para">If the stylesheet version is determined as 3.0, the following happens:</p><ul class="itemizedlist"><li><p class="para">The following options are ignored: <code class="code option">static-parameters</code>, <code class="code option">global-context-item</code>.</p></li><li><p class="para">An XSLT version&nbsp;2.0 stylesheet has an <span class="emphasis italic">initial context node</span>, the initial data the stylesheet works upon. This
            is determined as follows:</p><ul class="itemizedlist"><li><p class="para">When no documents appear on the <code class="code port">source</code> port, the initial context node is undefined/empty.</p></li><li><p class="para">When one or multiple documents appear on the <code class="code port">source</code> port, only the <span class="emphasis italic">first</span> document becomes the
                initial context node.</p></li></ul></li><li><p class="para">If the <code class="code option">populate-default-collection</code> is set to <code class="code">true</code>, all documents that appear on the <code class="code port">source</code>
            port become the <span class="emphasis italic">default collection</span>, accessible using the XPath <a href="https://www.w3.org/TR/xpath-functions-31/#func-collection" target="_blank"><span class="link newpage">collection()</span></a> function.</p></li><li><p class="para">Then it is determined how to start the stylesheet processing:</p><ul class="itemizedlist"><li><p class="para">If the <code class="code option">template-name</code> is <span class="emphasis italic">not</span> set, the normal “apply-template invocation” is
                performed. The document(s) that appear on the <code class="code port">source</code> port are used, one by one, for the initial match.</p><p class="para">If the <code class="code option">initial-mode</code> option is set, processing starts in that mode.</p></li><li><p class="para">If the <code class="code option">template-name</code> is set, the named template with that name (<code class="tag">&lt;xsl:template name="…"&gt;</code>) is
                invoked.</p><p class="para">The <code class="code option">initial-mode</code> option is ignored.</p></li></ul></li><li><p class="para">The stylesheet processes.</p></li><li><p class="para">The result(s) appears on the output port(s):</p><ul class="itemizedlist"><li><p class="para">The principal result document of the stylesheet appears on the <code class="code port">result</code> port.</p></li><li><p class="para">Any results created by <code class="tag">&lt;xsl:result-document&gt;</code> instructions appear on the <code class="code port">secondary</code> port. </p></li></ul></li><li><p class="para">Finally, the base URIs of the resulting documents (their <code class="code property">base-uri</code> document-property values) are determined. For
            this we first need to determine the <span class="emphasis italic">base-output-URI</span>:</p><ul class="itemizedlist"><li><p class="para">If the <code class="code option">base-output-uri</code> option is set, this value is used as base-output-URI.</p></li><li><p class="para">If the <code class="code option">base-output-uri</code> option is <span class="emphasis italic">not</span> set <span class="emphasis italic">and</span> there are documents on the
                  <code class="code port">source</code> port, the base URI of the <span class="emphasis italic">first</span> document on the <code class="code port">source</code> port is used as base
                output URI.</p></li><li><p class="para">If the <code class="code option">base-output-uri</code> option is <span class="emphasis italic">not</span> set <span class="emphasis italic">and</span> there are
                  <span class="emphasis italic">no</span> documents on the <code class="code port">source</code> port, the base URI of the stylesheet is used as base-output-URI.</p></li></ul><p class="para">The base URIs of the resulting documents (their <code class="code property">base-uri</code> document-property values) are now computed using this
            base-output-URI:</p><ul class="itemizedlist"><li><p class="para">The base URI of the principal output document becomes the base-output-URI.</p></li><li><p class="para">For all documents appearing on the <code class="code port">secondary</code> port, the base URI is determined by the
                  <code class="code">xsl:result-document/@href</code> attribute. A relative value is made absolute against the base-output-URI.</p></li></ul></li></ul></div><div class="sect3" id="sect3-d547e34199"><a name="sect3-d547e34199"><!----></a><h3 class="sect3">Invoking an XSLT&nbsp;1.0 stylesheet</h3><p class="para">If the stylesheet version is determined as 1.0, the following happens:</p><ul class="itemizedlist"><li><p class="para">The following options are ignored: <code class="code option">global-context-item</code>, <code class="code option">initial-mode</code>,
              <code class="code option">populate-default-collection</code>, <code class="code option">static-parameters</code>, <code class="code option">template-name</code>.</p></li><li><p class="para">There must be exactly one document appearing on the <code class="code port">source</code> port. This document will be processed.</p></li><li><p class="para">The stylesheet processes.</p></li><li><p class="para">The resulting document appears on the <code class="code port">result</code> port. The <code class="code port">secondary</code> port will always be empty.</p></li><li><p class="para">Finally, the base URI of the resulting document (its <code class="code property">base-uri</code> document-property value) is determined. For this we
            first need to determine the <span class="emphasis italic">base-output-URI</span>:</p><ul class="itemizedlist"><li><p class="para">If the <code class="code option">base-output-uri</code> option is set, this value is used as base-output-URI.</p></li><li><p class="para">If the <code class="code option">base-output-uri</code> option is <span class="emphasis italic">not</span> set, the base URI of the <span class="emphasis italic">first</span>
                document on the <code class="code port">source</code> port is used as base-output-URI.</p></li></ul><p class="para">The base URI of the output document becomes the base-output-URI.</p></li></ul></div></div><div class="sect2" id="sect2-d547e34303"><a name="sect2-d547e34303"><!----></a><h2 class="sect2">Examples</h2><div class="sect3" id="p_xslt-v30-basic-usage"><a name="p_xslt-v30-basic-usage"><!----></a><h3 class="sect3">Basic usage</h3><p class="para">For the following example, we’ll use a very simple (3.0) stylesheet, called <code class="code">add-comment.xsl</code>, that adds a comment as the
      first child of the root element:</p><div class="programlisting"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xsl:stylesheet version="3.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:xs="http://www.w3.org/2001/XMLSchema" expand-text="true"&gt;

  &lt;xsl:mode on-no-match="shallow-copy"/&gt;

  &lt;xsl:param name="comment-text" as="xs:string" required="false" select="'This is an added comment'"/&gt;

  &lt;xsl:template match="/*"&gt;
    &lt;xsl:copy&gt;
      &lt;xsl:apply-templates select="@*"/&gt;
      &lt;xsl:comment&gt; == {current-dateTime()} - {$comment-text} == &lt;/xsl:comment&gt;
      &lt;xsl:apply-templates/&gt;
    &lt;/xsl:copy&gt;
  &lt;/xsl:template&gt;

&lt;/xsl:stylesheet&gt;</pre></div><p class="para">Running this without any bells and whistles is as follows:</p><p class="para keep-with-next">Source document:</p><div class="programlisting"><pre class="programlisting">&lt;customers&gt;
   &lt;customer&gt;
      &lt;name&gt;PXSLT Company Ltd&lt;/name&gt;
   &lt;/customer&gt;
&lt;/customers&gt;</pre></div><p class="para keep-with-next">Pipeline document:</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:input port="source"/&gt;
  &lt;p:output port="result"/&gt;

  &lt;p:xslt&gt;
    &lt;p:with-input port="stylesheet" href="add-comment.xsl"/&gt;
  &lt;/p:xslt&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para keep-with-next">Result document:</p><div class="programlisting"><pre class="programlisting">&lt;customers&gt;&lt;!-- == 2025-01-22T11:09:42.7038225+01:00 - This is an added comment == --&gt;
   &lt;customer&gt;
      &lt;name&gt;PXSLT Company Ltd&lt;/name&gt;
   &lt;/customer&gt;
&lt;/customers&gt;</pre></div><p class="para">Setting a stylesheet parameter is done by supplying a map with parameter name/value pairs as the value of the
            <code class="code option">parameters</code> option:</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:input port="source"/&gt;
  &lt;p:output port="result"/&gt;

  &lt;p:xslt parameters="map{'comment-text': 'Special comment text by parameter!'}"&gt;
    &lt;p:with-input port="stylesheet" href="add-comment.xsl"/&gt;
  &lt;/p:xslt&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para keep-with-next">Result document:</p><div class="programlisting"><pre class="programlisting">&lt;customers&gt;&lt;!-- == 2025-01-22T11:09:42.7765799+01:00 - Special comment text by parameter! == --&gt;
   &lt;customer&gt;
      &lt;name&gt;PXSLT Company Ltd&lt;/name&gt;
   &lt;/customer&gt;
&lt;/customers&gt;</pre></div></div><div class="sect3" id="p_xslt-v30-basic-usage-2"><a name="p_xslt-v30-basic-usage-2"><!----></a><h3 class="sect3">Basic usage with secondary documents</h3><p class="para">The output of <code class="tag">&lt;xsl:result-document&gt;</code> stylesheet instructions is written to the <code class="code port">secondary</code> port of the <code class="code step">p:xslt</code>
      invocation. The base URI of these documents is the value of the <code class="code">xsl:result-document/@href</code> attribute.</p><p class="para">The following stylesheet, called <code class="code">split-documents.xsl</code>, writes the contents of each <code class="tag">&lt;document&gt;</code> element to a separate,
      secondary, document. The base URI of the output documents is inferred from the <code class="code">document/@name</code> attribute. The primary output of the
      stylesheet is almost identical to its input: the full URI of each written secondary output document is added to the <code class="tag">&lt;document&gt;</code> element
      in an <code class="code">href</code> attribute.</p><div class="programlisting"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xsl:stylesheet version="3.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:xs="http://www.w3.org/2001/XMLSchema" expand-text="true"&gt;

  &lt;xsl:mode on-no-match="shallow-copy"/&gt;

  &lt;xsl:template match="document"&gt;
    &lt;xsl:variable name="href" as="xs:string" select="resolve-uri('tmp/' || @name)"/&gt;
    &lt;xsl:result-document href="{$href}"&gt;
      &lt;xsl:sequence select="*"/&gt;
    &lt;/xsl:result-document&gt;
    &lt;xsl:copy&gt;
      &lt;xsl:copy-of select="@*"/&gt;
      &lt;xsl:attribute name="href" select="$href"/&gt;
      &lt;xsl:apply-templates/&gt;
    &lt;/xsl:copy&gt;
  &lt;/xsl:template&gt;

&lt;/xsl:stylesheet&gt;</pre></div><p class="para">When using this stylesheet in an XProc pipeline, the documents, written by <code class="tag">&lt;xsl:result-document&gt;</code> instructions, end up on the
        <code class="code port">secondary</code> port. If we want these written to disk, we need to add some code for it.</p><p class="para keep-with-next">Source document:</p><div class="programlisting"><pre class="programlisting">&lt;documents&gt;
   &lt;document name="x1.xml"&gt;
      &lt;document-1/&gt;
   &lt;/document&gt;
   &lt;document name="x2.xml"&gt;
      &lt;document-2/&gt;
   &lt;/document&gt;
&lt;/documents&gt;</pre></div><p class="para keep-with-next">Pipeline document:</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:input port="source"/&gt;
  &lt;p:output port="result" pipe="result@create-secondary-documents"/&gt;

  &lt;p:xslt name="create-secondary-documents"&gt;
    &lt;p:with-input port="stylesheet" href="split-documents.xsl"/&gt;
  &lt;/p:xslt&gt;

  &lt;p:for-each&gt;
    &lt;p:with-input pipe="secondary"/&gt;
    &lt;p:store href="{base-uri(/)}"/&gt;
  &lt;/p:for-each&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para keep-with-next">Result document:</p><div class="programlisting"><pre class="programlisting">&lt;documents&gt;
   &lt;document name="x1.xml" href="file:/…/…/tmp/x1.xml"&gt;
      &lt;document-1/&gt;
   &lt;/document&gt;
   &lt;document name="x2.xml" href="file:/…/…/tmp/x2.xml"&gt;
      &lt;document-2/&gt;
   &lt;/document&gt;
&lt;/documents&gt;</pre></div><p class="para">The primary output of the <code class="code step">p:xslt</code> is explicitly piped to the output port of the pipeline here (by the <code class="code">p:output/@pipe</code>
      attribute).</p><p class="para">The <code class="code">p:for-each</code> after the <code class="code step">p:xslt</code> iterates over all secondary documents and invokes <code class="code step"><a href="p.store.html"><span class="link">p:store</span></a></code> to store them to
      disk, using their base URI, that was set by the stylesheet. The result will be two documents, called <code class="code">x1.xml</code> and
      <code class="code">x2.xml</code>, in the <code class="code">tmp/</code> folder underneath the stylesheet location.</p></div></div><div class="sect2" id="sect2-d547e34398"><a name="sect2-d547e34398"><!----></a><h2 class="sect2">Additional details</h2><ul class="itemizedlist"><li><p class="para">Which XSLT version(s) is/are supported is implementation-defined and therefore depends on the XProc processor used. In most cases at least
      version 3.0 will be supported.</p></li><li><p class="para">No document-properties from the source document(s) are preserved.</p></li><li><p class="para">The <code class="code property">base-uri</code> document of each result document (both for the <code class="code port">result</code> and the <code class="code port">secondary</code> port) is
      determined by the transformation. If the transformation does not establish a base URI, the document will not have a
        <code class="code property">base-uri</code> document-property.</p></li><li><p class="para">If the <code class="code option">template-name</code> option is set, the <code class="code option">initial-mode</code> option is ignored.</p></li><li><p class="para">A relative value for the <code class="code option">output-base-uri</code> option is made absolute against the base URI of the element in the pipeline it is
      specified on. In most cases this will be the path of the pipeline document.</p></li><li><p class="para">An XSLT stylesheet can terminate processing using an <code class="tag">&lt;xsl:message terminate="true"&gt;</code> instruction. How such a termination is reported
      by the XProc processor is implementation-defined and therefore depends on the XProc processor used.</p></li><li><p class="para">The order in which result documents appear on the <code class="code port">secondary</code> port is implementation-defined and therefore depends on the XProc
      processor used.</p></li></ul></div><div class="sect2" id="sect2-d547e34450"><a name="sect2-d547e34450"><!----></a><h2 class="sect2">Errors raised</h2><div class="table nonumber error-codes-table"><table class="table nonumber error-codes-table"><thead><tr><th><p class="para">Error code</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para" id="error-XC0007"><a name="error-XC0007"><!----></a><a href="../error-codes.html#error-XC0007"><span class="link"><code class="code">XC0007</code></span></a></p></td><td><p class="para">It is a dynamic error if any key in <code class="code option">parameters</code> is associated to a value which is not an instance of the XQuery 1.0 and
        XPath 2.0 Data Model, e.g. with a map, an array, or a function.</p></td></tr><tr><td><p class="para" id="error-XC0008"><a name="error-XC0008"><!----></a><a href="../error-codes.html#error-XC0008"><span class="link"><code class="code">XC0008</code></span></a></p></td><td><p class="para">It is a dynamic error if the stylesheet does not support a given mode.</p></td></tr><tr><td><p class="para" id="error-XC0038"><a name="error-XC0038"><!----></a><a href="../error-codes.html#error-XC0038"><span class="link"><code class="code">XC0038</code></span></a></p></td><td><p class="para">It is a dynamic error if the specified xslt version is not available.</p></td></tr><tr><td><p class="para" id="error-XC0039"><a name="error-XC0039"><!----></a><a href="../error-codes.html#error-XC0039"><span class="link"><code class="code">XC0039</code></span></a></p></td><td><p class="para">It is a dynamic error if the source port does not contain exactly one XML document or one HTML document if XSLT 1.0 is used.</p></td></tr><tr><td><p class="para" id="error-XC0056"><a name="error-XC0056"><!----></a><a href="../error-codes.html#error-XC0056"><span class="link"><code class="code">XC0056</code></span></a></p></td><td><p class="para">It is a dynamic error if the stylesheet does not provide a given template.</p></td></tr><tr><td><p class="para" id="error-XC0093"><a name="error-XC0093"><!----></a><a href="../error-codes.html#error-XC0093"><span class="link"><code class="code">XC0093</code></span></a></p></td><td><p class="para"> It is a dynamic error if a static error occurs during the static analysis of the XSLT stylesheet.</p></td></tr><tr><td><p class="para" id="error-XC0094"><a name="error-XC0094"><!----></a><a href="../error-codes.html#error-XC0094"><span class="link"><code class="code">XC0094</code></span></a></p></td><td><p class="para">It is a dynamic error if any document supplied on the source port is not an XML document, an HTML documents, or a Text document if XSLT
        2.0 is used.</p></td></tr><tr><td><p class="para" id="error-XC0095"><a name="error-XC0095"><!----></a><a href="../error-codes.html#error-XC0095"><span class="link"><code class="code">XC0095</code></span></a></p></td><td><p class="para">It is a dynamic error if an error occurred during the transformation.</p></td></tr><tr><td><p class="para" id="error-XC0096"><a name="error-XC0096"><!----></a><a href="../error-codes.html#error-XC0096"><span class="link"><code class="code">XC0096</code></span></a></p></td><td><p class="para">It is a dynamic error if the transformation is terminated by XSLT message termination.</p></td></tr><tr><td><p class="para" id="error-XC0105"><a name="error-XC0105"><!----></a><a href="../error-codes.html#error-XC0105"><span class="link"><code class="code">XC0105</code></span></a></p></td><td><p class="para">It is a dynamic error if an XSLT 1.0 stylesheet is invoked and option <code class="code option">parameters</code> contains a value that is not an atomic
        value or a node.</p></td></tr><tr><td><p class="para" id="error-XC0121"><a name="error-XC0121"><!----></a><a href="../error-codes.html#error-XC0121"><span class="link"><code class="code">XC0121</code></span></a></p></td><td><p class="para">It is a dynamic error if a document appearing on the <code class="code port">secondary</code> port has a base URI that is not both absolute and valid
        according to <a href="https://www.rfc-editor.org/info/rfc3986" target="_blank"><span class="link newpage">RFC&nbsp;3986</span></a> .</p></td></tr></tbody></table></div></div><div class="sect2" id="sect2-d547e34576"><a name="sect2-d547e34576"><!----></a><h2 class="sect2">Reference information</h2><p class="para">This description of the <code class="code step">p:xslt</code> step is for XProc version: <a href="../index.html"><span class="link">3.0</span></a>. This is a required step (an XProc 3.0 processor must support this).</p><p class="para">The formal specification for the <code class="code step">p:xslt</code> step can be found <a href="https://spec.xproc.org/3.0/steps/#c.xslt" target="_blank"><span class="link newpage">here</span></a>.</p><p class="para">The <code class="code step">p:xslt</code> step is part of categories:</p><ul class="itemizedlist"><li><p class="para"><a href="Standard_XProc_steps.html"><span class="link">Standard XProc steps</span></a></p></li><li><p class="para"><a href="Additional_standards.html"><span class="link">Additional standards</span></a></p></li></ul><p class="para">The <code class="code step">p:xslt</code> step is also present in version:
                <a href="../3.1/p.xslt.html"><span class="link">3.1</span></a>.</p></div></div></div><p>&nbsp;</p></body></html>