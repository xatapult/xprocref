<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xtlcon="http://www.xtpxlib.nl/ns/container"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="keywords" content="xproc xprocref xml step p:wrap-sequence wrap-sequence documents wrap element node"><link href="../css/bootstrap.min.css" rel="stylesheet"><link href="../css/xprocref.css" rel="stylesheet"><script defer src="../js/bootstrap.bundle.min.js"></script><title>&nbsp;p:wrap-sequence (3.0)&nbsp;</title><link rel="shortcut icon" href="../images/favicon.ico"></head><body><nav class="navbar navbar-expand-sm bg-secondary navbar-dark "><div class="container-fluid"><a class="navbar-brand" href="../index.html"><img src="../images/logo.png" class="img-fluid" width="18%"></a></div><div class="container-fluid"><ul class="nav justify-content-end nav-pills text-light"><li class="nav-item lead"><a class="nav-link text-light" href="../index.html">home</a></li><li class="nav-item lead"><a class="nav-link text-light" href="../3.1/categories.html">categories</a></li><li class="nav-item lead"><a class="nav-link text-light" href="../pdf.html">pdf</a></li><li class="nav-item dropdown lead"><a class="nav-link dropdown-toggle text-light" data-bs-toggle="dropdown" href="#">info</a><ul class="dropdown-menu"><li class="lead"><a class="dropdown-item" href="../versions.html">Versions</a></li><li class="lead"><a class="dropdown-item" href="../error-codes.html">Error codes</a></li><li class="lead"><a class="dropdown-item" href="../namespaces.html">Namespaces</a></li><li class="lead"><a class="dropdown-item" href="https://xproc.org">XProc</a></li><li class="lead"><a class="dropdown-item" href="https://github.com/xatapult/xprocref">Site GitHub</a></li><li class="lead"><a class="dropdown-item" href="https://github.com/xatapult/xprocref/issues">Site issues</a></li></ul></li><li class="nav-item lead"><a class="nav-link text-light" href="../about.html">about</a></li></ul></div></nav><div class="container pt-5"><div class="sect1" id="sect1-d628e78336"><a name="sect1-d628e78336"><!----></a><h1 class="sect1"><a href="p.wrap.html"><span class="link"><img src="../images/previous.png" class="inlinemediaobject next-prev-marker" width="1.5%"></span></a>&nbsp;p:wrap-sequence (3.0)&nbsp;<a href="p.www-form-urldecode.html"><span class="link"><img src="../images/next.png" class="inlinemediaobject next-prev-marker" width="1.5%"></span></a></h1><p class="para keep-with-next">Wraps a sequence of documents in an element.</p><ul class="itemizedlist toc toc-2"><li><p class="para tocentry tocentry-2"><a href="#sect2-d628e78349"><span class="link">Summary</span></a></p></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d628e78504"><span class="link">Description</span></a></p><ul class="itemizedlist toc toc-3"><li><p class="para tocentry tocentry-3"><a href="#grouping"><span class="link">Grouping</span></a></p></li></ul></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d628e78597"><span class="link">Examples</span></a></p><ul class="itemizedlist toc toc-3"><li><p class="para tocentry tocentry-3"><a href="#p_wrap-sequence-v30-ws-basic-usage"><span class="link">Basic usage</span></a></p></li><li><p class="para tocentry tocentry-3"><a href="#p_wrap-sequence-v30-ws-usecase-1"><span class="link">Wrapping the results of a for-each loop</span></a></p></li><li><p class="para tocentry tocentry-3"><a href="#p_wrap-sequence-v30-ws-grouping"><span class="link">Grouping and wrapping</span></a></p></li></ul></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d628e78689"><span class="link">Additional details</span></a></p></li><li><p class="para tocentry tocentry-2"><a href="#sect2-d628e78702"><span class="link">Reference information</span></a></p></li></ul><div class="sect2" id="sect2-d628e78349"><a name="sect2-d628e78349"><!----></a><h2 class="sect2">Summary</h2><div class="programlisting step-signature"><pre class="programlisting step-signature">&lt;p:declare-step type="p:wrap-sequence"&gt;
  &lt;input port="source" primary="true" content-types="text xml html" sequence="true"/&gt;
  &lt;output port="result" primary="true" content-types="application/xml" sequence="true"/&gt;
  &lt;option name="wrapper" as="xs:QName" required="true"/&gt;
  &lt;option name="group-adjacent" as="xs:string?" required="false" select="()"/&gt;
&lt;/p:declare-step&gt;</pre></div><p class="para">The <code class="code step">p:wrap-sequence</code> step takes a sequence of documents on its <code class="code port">source</code> port and wraps these in a wrapper element. The result appears on
      the <code class="code port">result</code> port. It can also group the source document(s) before wrapping, based on an XPath expression.</p><p class="para table-header keep-with-next">Ports:</p><div class="table nonumber ports-table"><table class="table nonumber ports-table"><thead><tr><th><p class="para">Port</p></th><th><p class="para">Type</p></th><th><p class="para">Primary?</p></th><th><p class="para">Content types</p></th><th><p class="para">Seq?</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code">source</code></p></td><td><p class="para"><code class="code">input</code></p></td><td><p class="para"><code class="code">true</code></p></td><td><p class="para"><code class="code">text xml html</code></p></td><td><p class="para"><code class="code">true</code></p></td><td><p class="para">The document(s) to wrap.</p></td></tr><tr><td><p class="para"><code class="code">result</code></p></td><td><p class="para"><code class="code">output</code></p></td><td><p class="para"><code class="code">true</code></p></td><td><p class="para"><code class="code">application/xml</code></p></td><td><p class="para"><code class="code">true</code></p></td><td><p class="para">The resulting wrapped document(s)</p></td></tr></tbody></table></div><p class="para table-header keep-with-next">Options:</p><div class="table nonumber options-table"><table class="table nonumber options-table"><thead><tr><th><p class="para">Name</p></th><th><p class="para">Type</p></th><th><p class="para">Req?</p></th><th><p class="para">Default</p></th><th><p class="para">Description</p></th></tr></thead><tbody><tr><td><p class="para"><code class="code">wrapper</code></p></td><td><p class="para"><code class="code">xs:QName</code></p></td><td><p class="para"><code class="code">true</code></p></td><td><p class="para"><code class="code">&nbsp;</code></p></td><td><p class="para">The element to wrap the document(s) in.</p></td></tr><tr><td><p class="para"><code class="code">group-adjacent</code></p></td><td><p class="para"><code class="code">xs:string?</code> (XPath expression)</p></td><td><p class="para"><code class="code">false</code></p></td><td><p class="para"><code class="code">()</code></p></td><td><p class="para">An XPath expression to use for grouping the wrapped elements. See <a href="#grouping" class="xref">Grouping</a> below.</p></td></tr></tbody></table></div></div><div class="sect2" id="sect2-d628e78504"><a name="sect2-d628e78504"><!----></a><h2 class="sect2">Description</h2><p class="para">Basic usage of the <code class="code step">p:wrap-sequence</code> step is to wrap an element around a sequence of text, XML or HTML documents. This action turns the sequence into
      a single XML document. See <a href="#p_wrap-sequence-v30-ws-basic-usage"><span class="link">Basic usage</span></a> for how this works. This example is however not very useful. A much more common
      scenario, wrapping the results of a <code class="code">p:for-each</code> loop, is shown in the <a href="#p_wrap-sequence-v30-ws-usecase-1"><span class="link">Wrapping the results of a for-each loop</span></a> example.</p><div class="sect3" id="grouping"><a name="grouping"><!----></a><h3 class="sect3">Grouping</h3><p class="para">The <code class="code option">group-adjacent</code> option of <code class="code step">p:wrap-sequence</code> allows you to group documents together and wrap each group in the same wrapper
        element. The value of this option must a valid XPath expression. It is evaluated for every document in the input sequence. Documents with an
        equal result value are bundled together, resulting in a sequence of documents on the <code class="code port">result</code> port.</p><p class="para">For all documents appearing on the <code class="code port">source</code> port:</p><ul class="itemizedlist"><li><p class="para">The document becomes the context item (accessible with the dot <code class="code">.</code> operator).</p></li><li><p class="para">The expression in the <code class="code option">group-adjacent</code> option is evaluated.</p><p class="para">During this evaluation, the <code class="code">position()</code> and <code class="code">last()</code> functions are available to get the position of the
            document in the sequence and the size of the sequence.</p></li><li><p class="para">Two values computed by the XPath expression are considered equal if the XPath function <a href="https://www.w3.org/TR/xpath-functions-31/#func-deep-equal" target="_blank"><span class="link newpage"><code class="code">deep-equal()</code></span></a> returns
              <code class="code">true</code> for them. In most cases this simply means that values are equal when you intuitively expect them to be.</p></li><li><p class="para">All documents with equal values for the XPath expression, that are adjacent in the sequence, are wrapped in an element named by the
              <code class="code option">wrapper</code> option.</p></li></ul><p class="para">For an example see <a href="#p_wrap-sequence-v30-ws-grouping"><span class="link">Grouping and wrapping</span></a>.</p></div></div><div class="sect2" id="sect2-d628e78597"><a name="sect2-d628e78597"><!----></a><h2 class="sect2">Examples</h2><div class="sect3" id="p_wrap-sequence-v30-ws-basic-usage"><a name="p_wrap-sequence-v30-ws-basic-usage"><!----></a><h3 class="sect3">Basic usage</h3><p class="para">The <code class="code port">source</code> port here receives a sequence of 4 <code class="tag">&lt;fruit&gt;</code> documents, by default. <code class="code step">p:wrap-sequence</code> wraps this into a
        <code class="tag">&lt;fruits&gt;</code> element, turning the four separate documents into a single one.</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:input port="source" sequence="true"&gt;
    &lt;fruit name="banana" color="yellow"/&gt;
    &lt;fruit name="orange" color="orange"/&gt;
    &lt;fruit name="carrot" color="orange"/&gt;
    &lt;fruit name="lemon" color="yellow"/&gt;
  &lt;/p:input&gt;
  &lt;p:output port="result"/&gt;

  &lt;p:wrap-sequence wrapper="fruits"/&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para keep-with-next">Result document:</p><div class="programlisting"><pre class="programlisting">&lt;fruits&gt;
   &lt;fruit color="yellow" name="banana"/&gt;
   &lt;fruit color="orange" name="orange"/&gt;
   &lt;fruit color="orange" name="carrot"/&gt;
   &lt;fruit color="yellow" name="lemon"/&gt;
&lt;/fruits&gt;</pre></div></div><div class="sect3" id="p_wrap-sequence-v30-ws-usecase-1"><a name="p_wrap-sequence-v30-ws-usecase-1"><!----></a><h3 class="sect3">Wrapping the results of a for-each loop</h3><p class="para">A very common scenario in which <code class="code step">p:wrap-sequence</code> is used, is in wrapping the results of a <code class="code">p:for-each</code> loop. Such a loop usually results
      in a sequence of documents (one for each iteration). It’s often easier to turn this (back) into a single document before continuing. The
      following example shows this. It has a <code class="code">p:for-each</code> loop over all yellow fruit elements that adds an attribute
        <code class="code">delivery="special"</code>. The resulting documents are wrapped in a <code class="tag">&lt;yellow-fruits&gt;</code> element, resulting in a single result
      document.</p><p class="para keep-with-next">Source document:</p><div class="programlisting"><pre class="programlisting">&lt;fruits&gt;
   &lt;fruit name="banana" color="yellow"/&gt;
   &lt;fruit name="orange" color="orange"/&gt;
   &lt;fruit name="carrot" color="orange"/&gt;
   &lt;fruit name="lemon" color="yellow"/&gt;
&lt;/fruits&gt;</pre></div><p class="para keep-with-next">Pipeline document:</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:input port="source" sequence="true"/&gt;
  &lt;p:output port="result"/&gt;

  &lt;p:for-each&gt;
    &lt;p:with-input select="/*/*[@color eq 'yellow']"/&gt;
    &lt;p:add-attribute attribute-name="delivery" attribute-value="special"/&gt;
  &lt;/p:for-each&gt;

  &lt;p:wrap-sequence wrapper="yellow-fruits"/&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para keep-with-next">Result document:</p><div class="programlisting"><pre class="programlisting">&lt;yellow-fruits&gt;
   &lt;fruit delivery="special" color="yellow" name="banana"/&gt;
   &lt;fruit delivery="special" color="yellow" name="lemon"/&gt;
&lt;/yellow-fruits&gt;</pre></div></div><div class="sect3" id="p_wrap-sequence-v30-ws-grouping"><a name="p_wrap-sequence-v30-ws-grouping"><!----></a><h3 class="sect3">Grouping and wrapping</h3><p class="para">Like <a href="#p_wrap-sequence-v30-ws-basic-usage"><span class="link">Basic usage</span></a>, the <code class="code port">source</code> port here receives a sequence of 4 <code class="tag">&lt;fruit&gt;</code> documents. The first
      <code class="code step">p:wrap-sequence</code> step groups these, using the <code class="code">color</code> attribute, and wraps these groups in a <code class="tag">&lt;fruits-by-color&gt;</code> element. This results
      in a sequence of 3 documents, which is wrapped again, to enable showing it as a single document.</p><div class="programlisting"><pre class="programlisting">&lt;p:declare-step xmlns:p="http://www.w3.org/ns/xproc" version="3.0"&gt;

  &lt;p:input port="source" sequence="true"&gt;
    &lt;fruit name="banana" color="yellow"/&gt;
    &lt;fruit name="orange" color="orange"/&gt;
    &lt;fruit name="carrot" color="orange"/&gt;
    &lt;fruit name="lemon" color="yellow"/&gt;
  &lt;/p:input&gt;
  &lt;p:output port="result" sequence="true"/&gt;

  &lt;p:wrap-sequence wrapper="fruits-by-color" group-adjacent="/*/@color"/&gt;
  &lt;p:wrap-sequence wrapper="groups"/&gt;

&lt;/p:declare-step&gt;</pre></div><p class="para keep-with-next">Result document:</p><div class="programlisting"><pre class="programlisting">&lt;groups&gt;
   &lt;fruits-by-color&gt;
      &lt;fruit color="yellow" name="banana"/&gt;
   &lt;/fruits-by-color&gt;
   &lt;fruits-by-color&gt;
      &lt;fruit color="orange" name="orange"/&gt;
      &lt;fruit color="orange" name="carrot"/&gt;
   &lt;/fruits-by-color&gt;
   &lt;fruits-by-color&gt;
      &lt;fruit color="yellow" name="lemon"/&gt;
   &lt;/fruits-by-color&gt;
&lt;/groups&gt;</pre></div><p class="para">You might have expected that the result would group all fruits together by color, resulting in two documents: one for
        <code class="code">banana</code>+<code class="code">lemon</code> and one for <code class="code">orange</code>+<code class="code">carrot</code>. But <code class="code step">p:wrap-sequence</code> groups documents that are
        <span class="emphasis italic">adjacent</span> to each other only. It does <span class="emphasis italic">not</span> do what would be called “group by”: all
      documents with the same value for the XPath expression together in a single group. If you need this, you will have to sort the documents first.
      But unfortunately, XProc does not have anything on board for that. For more complex grouping, the advice is to use XSLT or XQuery.</p></div></div><div class="sect2" id="sect2-d628e78689"><a name="sect2-d628e78689"><!----></a><h2 class="sect2">Additional details</h2><ul class="itemizedlist"><li><p class="para">No document-properties of the source document(s) survive.</p></li><li><p class="para">The resulting document(s) have no <code class="code property">base-uri</code> property.</p></li></ul></div><div class="sect2 reference-section" id="sect2-d628e78702"><a name="sect2-d628e78702"><!----></a><h2 class="sect2 reference-section">Reference information</h2><p class="para">This description of the <code class="code step">p:wrap-sequence</code> step is for XProc version: <a href="index.html"><span class="link">3.0</span></a>. This is a required step (an XProc 3.0 processor must support this).</p><p class="para">The formal specification for the <code class="code step">p:wrap-sequence</code> step can be found <a href="https://spec.xproc.org/3.0/steps/#c.wrap-sequence" target="_blank"><span class="link newpage specification-link">here</span></a>.</p><p class="para">The <code class="code step">p:wrap-sequence</code> step is part of categories:</p><ul class="itemizedlist"><li><p class="para"><a href="Standard_XProc_steps.html"><span class="link">Standard XProc steps</span></a></p></li><li><p class="para"><a href="Miscellaneous.html"><span class="link">Miscellaneous</span></a></p></li></ul><p class="para">The <code class="code step">p:wrap-sequence</code> step is also present in version:
                <a href="../3.1/p.wrap-sequence.html"><span class="link">3.1</span></a>.</p></div></div></div><p>&nbsp;</p></body></html>